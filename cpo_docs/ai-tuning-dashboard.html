<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>AI Model Tuning Dashboard</title>
<link rel="stylesheet" href="/cpo/docs/styles.css"/>
<style>
.tuning-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
.tuning-card { background: #1e2a44; padding: 20px; border-radius: 12px; border: 1px solid #2d3a5a; }
.tuning-card h3 { color: #7dd3fc; margin-top: 0; font-size: 18px; }
.param { margin: 15px 0; }
.param label { display: block; color: #9fb3c8; font-size: 13px; margin-bottom: 5px; }
.param input[type="range"] { width: 100%; }
.param input[type="number"] { width: 100%; padding: 8px; background: #0a1220; border: 1px solid #2d3a5a; color: #e6edf3; border-radius: 6px; }
.value-display { color: #7dd3fc; font-weight: bold; float: right; }
.save-btn { background: #0ea5e9; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-top: 10px; }
.save-btn:hover { background: #0284c7; }
.status { padding: 10px; border-radius: 8px; margin: 10px 0; background: #1e3a5f; color: #7dd3fc; }
</style>
</head>
<body>
<div class="header">
  <h1>🎛️ AI Model Tuning Dashboard</h1>
  <p class="small">Configure AI service parameters for optimal performance</p>
</div>

<div class="container">
  <div class="status" id="status">
    ℹ️ Load current settings or adjust parameters below
  </div>

  <div class="tuning-grid">

    <!-- Voice Matching Tuner -->
    <div class="tuning-card">
      <h3>🎤 Voice Matching</h3>
      <div class="param">
        <label>Confidence Threshold <span class="value-display" id="voice-threshold-val">0.75</span></label>
        <input type="range" id="voice-threshold" min="0" max="1" step="0.05" value="0.75"
               oninput="document.getElementById('voice-threshold-val').textContent = this.value">
      </div>
      <div class="param">
        <label>Context Window (words) <span class="value-display" id="voice-context-val">100</span></label>
        <input type="range" id="voice-context" min="50" max="500" step="50" value="100"
               oninput="document.getElementById('voice-context-val').textContent = this.value">
      </div>
      <div class="param">
        <label>Temperature <span class="value-display" id="voice-temp-val">0.7</span></label>
        <input type="range" id="voice-temp" min="0" max="2" step="0.1" value="0.7"
               oninput="document.getElementById('voice-temp-val').textContent = this.value">
      </div>
      <button class="save-btn" onclick="saveVoiceSettings()">💾 Save Voice Settings</button>
    </div>

    <!-- Parser Tuner -->
    <div class="tuning-card">
      <h3>📰 Press Release Parser</h3>
      <div class="param">
        <label>Field Extraction Confidence <span class="value-display" id="parser-conf-val">0.80</span></label>
        <input type="range" id="parser-conf" min="0" max="1" step="0.05" value="0.80"
               oninput="document.getElementById('parser-conf-val').textContent = this.value">
      </div>
      <div class="param">
        <label>Learning Rate <span class="value-display" id="parser-lr-val">0.05</span></label>
        <input type="range" id="parser-lr" min="0.01" max="0.5" step="0.01" value="0.05"
               oninput="document.getElementById('parser-lr-val').textContent = this.value">
      </div>
      <div class="param">
        <label>Suggestion Threshold <span class="value-display" id="parser-sugg-val">0.60</span></label>
        <input type="range" id="parser-sugg" min="0" max="1" step="0.05" value="0.60"
               oninput="document.getElementById('parser-sugg-val').textContent = this.value">
      </div>
      <button class="save-btn" onclick="saveParserSettings()">💾 Save Parser Settings</button>
    </div>

    <!-- Tone Analyzer Tuner -->
    <div class="tuning-card">
      <h3>📈 Tone Analyzer</h3>
      <div class="param">
        <label>Formality Weight <span class="value-display" id="tone-formal-val">0.5</span></label>
        <input type="range" id="tone-formal" min="0" max="1" step="0.1" value="0.5"
               oninput="document.getElementById('tone-formal-val').textContent = this.value">
      </div>
      <div class="param">
        <label>Emotional Intensity <span class="value-display" id="tone-emotion-val">0.6</span></label>
        <input type="range" id="tone-emotion" min="0" max="1" step="0.1" value="0.6"
               oninput="document.getElementById('tone-emotion-val').textContent = this.value">
      </div>
      <div class="param">
        <label>Political Messaging Weight <span class="value-display" id="tone-political-val">0.8</span></label>
        <input type="range" id="tone-political" min="0" max="1" step="0.1" value="0.8"
               oninput="document.getElementById('tone-political-val').textContent = this.value">
      </div>
      <button class="save-btn" onclick="saveToneSettings()">💾 Save Tone Settings</button>
    </div>

    <!-- AP Style Checker Tuner -->
    <div class="tuning-card">
      <h3>📝 AP Style Checker</h3>
      <div class="param">
        <label>Strictness Level <span class="value-display" id="ap-strict-val">5</span></label>
        <input type="range" id="ap-strict" min="1" max="10" step="1" value="5"
               oninput="document.getElementById('ap-strict-val').textContent = this.value">
      </div>
      <div class="param">
        <label>Ignore Exceptions <span class="value-display" id="ap-exceptions-val">Yes</span></label>
        <input type="checkbox" id="ap-exceptions" checked
               onchange="document.getElementById('ap-exceptions-val').textContent = this.checked ? 'Yes' : 'No'">
      </div>
      <div class="param">
        <label>Auto-Fix Enabled <span class="value-display" id="ap-autofix-val">No</span></label>
        <input type="checkbox" id="ap-autofix"
               onchange="document.getElementById('ap-autofix-val').textContent = this.checked ? 'Yes' : 'No'">
      </div>
      <button class="save-btn" onclick="saveAPStyleSettings()">💾 Save AP Style Settings</button>
    </div>

    <!-- Quality Checker Tuner -->
    <div class="tuning-card">
      <h3>✅ Quality Checker</h3>
      <div class="param">
        <label>Minimum Quality Score <span class="value-display" id="quality-min-val">70</span></label>
        <input type="range" id="quality-min" min="0" max="100" step="5" value="70"
               oninput="document.getElementById('quality-min-val').textContent = this.value">
      </div>
      <div class="param">
        <label>Factual Verification Weight <span class="value-display" id="quality-fact-val">0.8</span></label>
        <input type="range" id="quality-fact" min="0" max="1" step="0.1" value="0.8"
               oninput="document.getElementById('quality-fact-val').textContent = this.value">
      </div>
      <div class="param">
        <label>Grammar Weight <span class="value-display" id="quality-grammar-val">0.6</span></label>
        <input type="range" id="quality-grammar" min="0" max="1" step="0.1" value="0.6"
               oninput="document.getElementById('quality-grammar-val').textContent = this.value">
      </div>
      <button class="save-btn" onclick="saveQualitySettings()">💾 Save Quality Settings</button>
    </div>

    <!-- Brief Enhancement Tuner -->
    <div class="tuning-card">
      <h3>✨ Brief Enhancement</h3>
      <div class="param">
        <label>Enhancement Level <span class="value-display" id="brief-level-val">Moderate</span></label>
        <select id="brief-level" style="width: 100%; padding: 8px; background: #0a1220; border: 1px solid #2d3a5a; color: #e6edf3; border-radius: 6px;"
                onchange="document.getElementById('brief-level-val').textContent = this.options[this.selectedIndex].text">
          <option value="minimal">Minimal</option>
          <option value="moderate" selected>Moderate</option>
          <option value="aggressive">Aggressive</option>
        </select>
      </div>
      <div class="param">
        <label>Preserve Original Voice <span class="value-display" id="brief-preserve-val">0.9</span></label>
        <input type="range" id="brief-preserve" min="0" max="1" step="0.1" value="0.9"
               oninput="document.getElementById('brief-preserve-val').textContent = this.value">
      </div>
      <div class="param">
        <label>Max Tokens <span class="value-display" id="brief-tokens-val">500</span></label>
        <input type="number" id="brief-tokens" min="100" max="2000" step="100" value="500"
               oninput="document.getElementById('brief-tokens-val').textContent = this.value">
      </div>
      <button class="save-btn" onclick="saveBriefSettings()">💾 Save Brief Settings</button>
    </div>

  </div>

  <div class="card" style="margin-top: 30px;">
    <h2>📊 Current Performance Metrics</h2>
    <div id="metrics-display">
      <p class="small">Click "Load Current Settings" to see live performance metrics</p>
    </div>
    <button class="save-btn" onclick="loadCurrentSettings()">🔄 Load Current Settings</button>
    <button class="save-btn" onclick="resetToDefaults()">↺ Reset All to Defaults</button>
  </div>

</div>

<div class="footer">
  <a href="/cpo" style="color: #7dd3fc;">← Return to CPO Portal</a>
</div>

<script>
async function saveVoiceSettings() {
  const settings = {
    confidenceThreshold: parseFloat(document.getElementById('voice-threshold').value),
    contextWindow: parseInt(document.getElementById('voice-context').value),
    temperature: parseFloat(document.getElementById('voice-temp').value)
  };

  try {
    const response = await fetch('/api/services/voice-analysis/config', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(settings)
    });

    if (response.ok) {
      showStatus('✅ Voice matching settings saved successfully', 'success');
    } else {
      showStatus('❌ Failed to save settings', 'error');
    }
  } catch (error) {
    showStatus('⚠️ Error: ' + error.message, 'error');
  }
}

async function saveParserSettings() {
  const settings = {
    confidenceThreshold: parseFloat(document.getElementById('parser-conf').value),
    learningRate: parseFloat(document.getElementById('parser-lr').value),
    suggestionThreshold: parseFloat(document.getElementById('parser-sugg').value)
  };

  try {
    const response = await fetch('/api/press-release-parser/config', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(settings)
    });

    if (response.ok) {
      showStatus('✅ Parser settings saved successfully', 'success');
    } else {
      showStatus('❌ Failed to save settings', 'error');
    }
  } catch (error) {
    showStatus('⚠️ Error: ' + error.message, 'error');
  }
}

async function saveToneSettings() {
  const settings = {
    formalityWeight: parseFloat(document.getElementById('tone-formal').value),
    emotionalIntensity: parseFloat(document.getElementById('tone-emotion').value),
    politicalWeight: parseFloat(document.getElementById('tone-political').value)
  };

  showStatus('✅ Tone analyzer settings saved (simulated)', 'success');
}

async function saveAPStyleSettings() {
  const settings = {
    strictness: parseInt(document.getElementById('ap-strict').value),
    ignoreExceptions: document.getElementById('ap-exceptions').checked,
    autoFix: document.getElementById('ap-autofix').checked
  };

  showStatus('✅ AP Style settings saved (simulated)', 'success');
}

async function saveQualitySettings() {
  const settings = {
    minQualityScore: parseInt(document.getElementById('quality-min').value),
    factualWeight: parseFloat(document.getElementById('quality-fact').value),
    grammarWeight: parseFloat(document.getElementById('quality-grammar').value)
  };

  showStatus('✅ Quality checker settings saved (simulated)', 'success');
}

async function saveBriefSettings() {
  const settings = {
    enhancementLevel: document.getElementById('brief-level').value,
    preserveVoice: parseFloat(document.getElementById('brief-preserve').value),
    maxTokens: parseInt(document.getElementById('brief-tokens').value)
  };

  showStatus('✅ Brief enhancement settings saved (simulated)', 'success');
}

async function loadCurrentSettings() {
  showStatus('🔄 Loading current settings and performance metrics...', 'info');

  try {
    const response = await fetch('/api/press-release-parser/feedback/metrics');
    if (response.ok) {
      const data = await response.json();
      displayMetrics(data);
    }
  } catch (error) {
    showStatus('⚠️ Could not load metrics: ' + error.message, 'error');
  }
}

function displayMetrics(data) {
  const metricsDiv = document.getElementById('metrics-display');
  let html = '<div class="tuning-grid">';

  if (data.metrics && data.metrics.length > 0) {
    data.metrics.forEach(metric => {
      const accuracy = Math.round((metric.accuracy_rate || 0) * 100);
      html += `
        <div style="background: #1e2a44; padding: 15px; border-radius: 8px;">
          <h4 style="color: #7dd3fc; margin-top: 0;">${metric.field_type}</h4>
          <p style="margin: 5px 0;"><strong>Accuracy:</strong> ${accuracy}%</p>
          <p style="margin: 5px 0;"><strong>Total Corrections:</strong> ${metric.total_corrections || 0}</p>
          <p style="margin: 5px 0;"><strong>Avg Confidence:</strong> ${Math.round((metric.avg_confidence || 0) * 100)}%</p>
        </div>
      `;
    });
  } else {
    html += '<p>No metrics available yet. Use the parser to generate data.</p>';
  }

  html += '</div>';
  metricsDiv.innerHTML = html;
  showStatus('✅ Metrics loaded successfully', 'success');
}

function resetToDefaults() {
  if (confirm('Reset all settings to defaults?')) {
    // Reset all sliders to default values
    document.getElementById('voice-threshold').value = 0.75;
    document.getElementById('voice-context').value = 100;
    document.getElementById('voice-temp').value = 0.7;
    document.getElementById('parser-conf').value = 0.80;
    document.getElementById('parser-lr').value = 0.05;
    document.getElementById('parser-sugg').value = 0.60;
    // ... reset others

    // Trigger oninput to update displays
    document.querySelectorAll('input[type="range"]').forEach(input => {
      input.dispatchEvent(new Event('input'));
    });

    showStatus('↺ All settings reset to defaults', 'info');
  }
}

function showStatus(message, type) {
  const status = document.getElementById('status');
  const icons = {
    success: '✅',
    error: '❌',
    info: 'ℹ️'
  };
  status.textContent = icons[type] + ' ' + message;
  status.style.background = type === 'success' ? '#1e3a2f' : type === 'error' ? '#3a1e1e' : '#1e3a5f';
}
</script>

</body>
</html>
