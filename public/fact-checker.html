<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automated Fact-Checking System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .header .stats {
            display: flex;
            gap: 30px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }

        .stat-item {
            flex: 1;
        }

        .stat-item .label {
            color: #666;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .stat-item .value {
            font-size: 24px;
            font-weight: 600;
            color: #333;
        }

        .claims-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .claim-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .claim-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }

        .claim-text {
            font-size: 16px;
            line-height: 1.6;
            color: #333;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .claim-meta {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-comparative { background: #e3f2fd; color: #1976d2; }
        .badge-structured { background: #f3e5f5; color: #7b1fa2; }
        .badge-standard { background: #f5f5f5; color: #616161; }

        .verify-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: opacity 0.2s, transform 0.1s;
            width: 100%;
        }

        .verify-button:hover {
            opacity: 0.9;
            transform: scale(1.02);
        }

        .verify-button:active {
            transform: scale(0.98);
        }

        .verify-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .verdict-container {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .verdict-true {
            background: #e8f5e9;
            border: 2px solid #4caf50;
        }

        .verdict-false {
            background: #ffebee;
            border: 2px solid #f44336;
        }

        .verdict-unsupported {
            background: #fff3e0;
            border: 2px solid #ff9800;
        }

        .verdict-misleading {
            background: #fff3e0;
            border: 2px solid #f57c00;
        }

        .verdict-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .verdict-icon {
            font-size: 24px;
        }

        .verdict-label {
            font-size: 18px;
            font-weight: 600;
        }

        .verdict-true .verdict-label { color: #2e7d32; }
        .verdict-false .verdict-label { color: #c62828; }
        .verdict-unsupported .verdict-label { color: #e65100; }
        .verdict-misleading .verdict-label { color: #e65100; }

        .confidence-bar {
            height: 8px;
            background: rgba(0,0,0,0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
        }

        .evidence-section {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(0,0,0,0.1);
        }

        .evidence-title {
            font-size: 13px;
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
        }

        .evidence-item {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
            padding-left: 12px;
            border-left: 2px solid #ddd;
        }

        .source-link {
            display: inline-block;
            margin-top: 4px;
            padding: 4px 10px;
            background: #e3f2fd;
            border-radius: 4px;
            color: #1976d2;
            text-decoration: none;
            font-size: 12px;
            font-weight: 500;
            transition: background 0.2s;
        }

        .source-link:hover {
            background: #bbdefb;
        }

        .sources-section {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(0,0,0,0.1);
        }

        .calculation-details {
            margin-top: 12px;
            padding: 12px;
            background: rgba(0,0,0,0.05);
            border-radius: 6px;
            font-size: 13px;
            color: #555;
        }

        .loader {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .upload-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .upload-section h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
            min-height: 120px;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .extract-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 15px;
            transition: opacity 0.2s;
        }

        .extract-button:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Automated Fact-Checking System</h1>
            <p style="color: #666; margin-top: 10px;">Powered by WebSearch, Comparative Analysis & Structured Extraction</p>
            <div class="stats">
                <div class="stat-item">
                    <div class="label">Total Claims</div>
                    <div class="value" id="totalClaims">0</div>
                </div>
                <div class="stat-item">
                    <div class="label">Verified</div>
                    <div class="value" id="verifiedCount">0</div>
                </div>
                <div class="stat-item">
                    <div class="label">TRUE</div>
                    <div class="value" style="color: #4caf50;" id="trueCount">0</div>
                </div>
                <div class="stat-item">
                    <div class="label">FALSE</div>
                    <div class="value" style="color: #f44336;" id="falseCount">0</div>
                </div>
            </div>
        </div>

        <div class="upload-section">
            <h2>üìù Extract Claims from Press Release</h2>
            <textarea id="pressReleaseText" placeholder="Paste press release text here..."></textarea>
            <button class="extract-button" onclick="extractClaims()">Extract & Analyze Claims</button>
        </div>

        <div class="claims-grid" id="claimsGrid"></div>
    </div>

    <script>
        let claims = [];
        let verifiedCount = 0;
        let trueCount = 0;
        let falseCount = 0;

        // Sample claims for demo
        const sampleClaims = [
            {
                id: 1,
                text: "More than 25% of the VA's workforce are veterans themselves.",
                method: "comparative",
                type: "greater_than"
            },
            {
                id: 2,
                text: "Our annual deficit is double what it was two years ago.",
                method: "comparative",
                type: "temporal_ratio"
            },
            {
                id: 3,
                text: "My opponent voted against the infrastructure bill 12 times.",
                method: "structured",
                type: "event"
            },
            {
                id: 4,
                text: "Crime has decreased by 15% in the district since 2020.",
                method: "structured",
                type: "quantity"
            }
        ];

        function initializeDemoClaims() {
            claims = sampleClaims;
            renderClaims();
            updateStats();
        }

        function renderClaims() {
            const grid = document.getElementById('claimsGrid');
            grid.innerHTML = claims.map(claim => `
                <div class="claim-card" id="claim-${claim.id}">
                    <div class="claim-text">${claim.text}</div>
                    <div class="claim-meta">
                        <span class="badge badge-${claim.method}">${claim.method.toUpperCase()}</span>
                        <span class="badge badge-standard">${claim.type}</span>
                    </div>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <button class="verify-button" onclick="verifyClaim(${claim.id})" style="flex: 1;">
                            üîç Auto-Verify with WebSearch
                        </button>
                        <button class="verify-button" onclick="toggleAddReference(${claim.id})" style="flex: 1; background: #10b981;">
                            üìé Add Reference
                        </button>
                    </div>
                    <div id="add-ref-form-${claim.id}" style="display: none; margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <input type="url" id="ref-url-${claim.id}" placeholder="Enter URL" style="width: 100%; padding: 8px; margin-bottom: 8px; border: 1px solid #ddd; border-radius: 4px;" />
                        <input type="text" id="ref-title-${claim.id}" placeholder="Title (optional)" style="width: 100%; padding: 8px; margin-bottom: 8px; border: 1px solid #ddd; border-radius: 4px;" />
                        <textarea id="ref-desc-${claim.id}" placeholder="Description (optional)" style="width: 100%; padding: 8px; margin-bottom: 8px; border: 1px solid #ddd; border-radius: 4px; resize: vertical; min-height: 60px;"></textarea>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="submitReference(${claim.id})" style="flex: 1; padding: 8px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">
                                ‚úì Validate & Add
                            </button>
                            <button onclick="toggleAddReference(${claim.id})" style="flex: 1; padding: 8px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">
                                Cancel
                            </button>
                        </div>
                    </div>
                    <div id="references-${claim.id}"></div>
                    <div id="verdict-${claim.id}"></div>
                </div>
            `).join('');
        }

        async function verifyClaim(claimId) {
            const button = document.querySelector(`#claim-${claimId} .verify-button`);
            const verdictContainer = document.getElementById(`verdict-${claimId}`);
            const claim = claims.find(c => c.id === claimId);

            button.disabled = true;
            button.innerHTML = '<span class="loader"></span> Verifying...';

            try {
                // Call real API
                const response = await fetch('http://localhost:3001/api/fact-checking/demo/verify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        claim: claim.text,
                        method: claim.method
                    })
                });

                if (!response.ok) {
                    throw new Error('Verification failed');
                }

                const results = await response.json();

                renderVerdict(claimId, results);

                button.innerHTML = '‚úì Verified';
                button.style.background = '#4caf50';

                updateStats();

            } catch (error) {
                console.error('Verification error:', error);
                button.innerHTML = '‚ùå Error';
                button.style.background = '#f44336';
                verdictContainer.innerHTML = `
                    <div class="verdict-container verdict-false">
                        <div class="verdict-header">
                            <span class="verdict-icon">‚ùå</span>
                            <span class="verdict-label">ERROR</span>
                        </div>
                        <div style="margin-top: 10px; color: #666;">
                            ${error.message || 'Failed to verify claim'}
                        </div>
                    </div>
                `;
            }
        }

        function getMockVerificationResult(claimId) {
            const mockResults = {
                1: {
                    verdict: "TRUE",
                    confidence: 0.95,
                    evidence: [
                        "VA reports 31% of workforce are veterans (va.gov, 2025)",
                        "Claimed: More than 25%, Actual: 31%"
                    ],
                    calculation: "31% > 25% ‚úì"
                },
                2: {
                    verdict: "FALSE",
                    confidence: 0.98,
                    evidence: [
                        "2025 deficit: $1.8 trillion (cbo.gov)",
                        "2023 deficit: $1.7 trillion (treasury.gov)"
                    ],
                    calculation: "Ratio: 1.8/1.7 = 1.06 (expected 2.0 for 'double'). Only 6% increase, not 100%."
                },
                3: {
                    verdict: "FALSE",
                    confidence: 0.85,
                    evidence: [
                        "Found 8 'NO' votes on infrastructure bills (congress.gov)",
                        "Claimed: 12 votes, Actual: 8 votes"
                    ],
                    calculation: "Missing 4 votes from claimed amount"
                },
                4: {
                    verdict: "UNSUPPORTED",
                    confidence: 0.60,
                    evidence: [
                        "Insufficient WebSearch results for verification",
                        "Would require BLS crime statistics API"
                    ],
                    calculation: "Manual verification recommended"
                }
            };

            return mockResults[claimId] || mockResults[1];
        }

        function renderVerdict(claimId, result) {
            const container = document.getElementById(`verdict-${claimId}`);
            const verdictClass = `verdict-${result.verdict.toLowerCase()}`;
            const icon = result.verdict === 'TRUE' ? '‚úÖ' : result.verdict === 'FALSE' ? '‚ùå' : result.verdict === 'MISLEADING' ? '‚ö†Ô∏è' : '‚ùì';

            // Build sources HTML if available
            let sourcesHTML = '';
            if (result.sources && result.sources.length > 0) {
                sourcesHTML = `
                    <div class="sources-section">
                        <div class="evidence-title">üîó Sources:</div>
                        ${result.sources.map(source => `
                            <a href="${source.url}" target="_blank" class="source-link" rel="noopener noreferrer">
                                ${source.name} ‚Üó
                            </a>
                        `).join('')}
                    </div>
                `;
            }

            container.innerHTML = `
                <div class="verdict-container ${verdictClass}">
                    <div class="verdict-header">
                        <span class="verdict-icon">${icon}</span>
                        <span class="verdict-label">${result.verdict}</span>
                    </div>
                    <div style="font-size: 13px; color: #666; margin-bottom: 8px;">
                        Confidence: ${(result.confidence * 100).toFixed(0)}%
                    </div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: ${result.confidence * 100}%"></div>
                    </div>
                    <div class="evidence-section">
                        <div class="evidence-title">üìö Evidence:</div>
                        ${result.evidence.map(e => `<div class="evidence-item">‚Ä¢ ${e}</div>`).join('')}
                    </div>
                    ${result.calculation ? `
                        <div class="calculation-details">
                            <strong>Calculation:</strong> ${result.calculation}
                        </div>
                    ` : ''}
                    ${sourcesHTML}
                </div>
            `;

            // Update counts
            if (result.verdict === 'TRUE') trueCount++;
            if (result.verdict === 'FALSE') falseCount++;
            verifiedCount++;
        }

        function updateStats() {
            document.getElementById('totalClaims').textContent = claims.length;
            document.getElementById('verifiedCount').textContent = verifiedCount;
            document.getElementById('trueCount').textContent = trueCount;
            document.getElementById('falseCount').textContent = falseCount;
        }

        async function extractClaims() {
            const text = document.getElementById('pressReleaseText').value;
            if (!text.trim()) {
                alert('Please paste a press release first');
                return;
            }

            // In production, this would call the API
            alert('Claim extraction would happen here via API call to:\nPOST /api/fact-checking/extract-claims');
        }

        // Toggle add reference form
        function toggleAddReference(claimId) {
            const form = document.getElementById(`add-ref-form-${claimId}`);
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }

        // Submit a manual reference
        async function submitReference(claimId) {
            const urlInput = document.getElementById(`ref-url-${claimId}`);
            const titleInput = document.getElementById(`ref-title-${claimId}`);
            const descInput = document.getElementById(`ref-desc-${claimId}`);

            const url = urlInput.value.trim();
            if (!url) {
                alert('Please enter a URL');
                return;
            }

            const button = event.target;
            button.disabled = true;
            button.textContent = '‚è≥ Validating...';

            try {
                // For demo, we'll show a simulated validation
                // In production, this would call: POST /api/fact-checking/claims/${claimId}/add-reference

                // Simulate URL validation
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Check if URL is valid format
                let urlObj;
                try {
                    urlObj = new URL(url);
                } catch (e) {
                    alert('Invalid URL format');
                    button.disabled = false;
                    button.textContent = '‚úì Validate & Add';
                    return;
                }

                // Simulate checking if URL is accessible
                const isValid = Math.random() > 0.2; // 80% success rate for demo

                const reference = {
                    id: Date.now(),
                    url,
                    title: titleInput.value.trim() || urlObj.hostname,
                    description: descInput.value.trim(),
                    validation_status: isValid ? 'valid' : 'unreachable',
                    http_status_code: isValid ? 200 : null,
                    added_at: new Date().toISOString()
                };

                // Display the reference
                displayReference(claimId, reference);

                // Clear form
                urlInput.value = '';
                titleInput.value = '';
                descInput.value = '';
                toggleAddReference(claimId);

                button.disabled = false;
                button.textContent = '‚úì Validate & Add';

            } catch (error) {
                console.error('Error adding reference:', error);
                alert('Failed to add reference');
                button.disabled = false;
                button.textContent = '‚úì Validate & Add';
            }
        }

        // Display a reference
        function displayReference(claimId, reference) {
            const container = document.getElementById(`references-${claimId}`);

            const statusColor = {
                'valid': '#10b981',
                'redirect': '#f59e0b',
                'invalid': '#ef4444',
                'unreachable': '#9ca3af',
                'timeout': '#f97316',
                'error': '#dc2626'
            }[reference.validation_status] || '#6b7280';

            const statusIcon = {
                'valid': '‚úì',
                'redirect': '‚Ü™',
                'invalid': '‚úó',
                'unreachable': '‚äò',
                'timeout': '‚è±',
                'error': '!'
            }[reference.validation_status] || '?';

            // Substantiation status colors and icons
            const substantiationColor = {
                'SUPPORTS': '#10b981',
                'REFUTES': '#ef4444',
                'NEUTRAL': '#f59e0b',
                'INSUFFICIENT': '#9ca3af',
                'ERROR': '#dc2626'
            }[reference.substantiation_status] || '#6b7280';

            const substantiationIcon = {
                'SUPPORTS': '‚úì',
                'REFUTES': '‚úó',
                'NEUTRAL': '~',
                'INSUFFICIENT': '?',
                'ERROR': '!'
            }[reference.substantiation_status] || '?';

            // Build substantiation section
            let substantiationHTML = '';
            if (reference.substantiation_status) {
                const confidencePercent = Math.round((reference.substantiation_confidence || 0) * 100);
                substantiationHTML = `
                    <div style="margin-top: 8px; padding: 10px; background: ${substantiationColor}15; border-radius: 4px; border: 1px solid ${substantiationColor}40;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                            <strong style="color: #333; font-size: 12px;">üìä Substantiation Analysis</strong>
                            <span style="background: ${substantiationColor}; color: white; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">
                                ${substantiationIcon} ${reference.substantiation_status} (${confidencePercent}%)
                            </span>
                        </div>
                        ${reference.substantiation_analysis ? `<div style="color: #555; font-size: 12px; margin-top: 6px;">${reference.substantiation_analysis}</div>` : ''}
                        ${reference.content_excerpt ? `
                            <div style="margin-top: 6px; padding: 8px; background: white; border-radius: 4px; font-size: 11px; color: #666; font-style: italic;">
                                "${reference.content_excerpt.substring(0, 200)}${reference.content_excerpt.length > 200 ? '...' : ''}"
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            const refHTML = `
                <div style="margin-top: 10px; padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 3px solid ${statusColor};">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 6px;">
                        <div style="flex: 1;">
                            <a href="${reference.url}" target="_blank" rel="noopener noreferrer" style="color: #667eea; text-decoration: none; font-weight: 500; font-size: 14px;">
                                ${reference.title} ‚Üó
                            </a>
                        </div>
                        <span style="background: ${statusColor}; color: white; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">
                            ${statusIcon} ${reference.validation_status.toUpperCase()}
                        </span>
                    </div>
                    ${reference.description ? `<div style="color: #666; font-size: 13px; margin-bottom: 6px;">${reference.description}</div>` : ''}
                    ${substantiationHTML}
                    <div style="color: #999; font-size: 11px; margin-top: 8px;">
                        Added ${new Date(reference.added_at).toLocaleString()}
                    </div>
                </div>
            `;

            container.innerHTML += refHTML;
        }

        // Initialize with demo claims
        initializeDemoClaims();
    </script>
</body>
</html>
