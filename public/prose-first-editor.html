<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campaign Content Editor ‚Äî Prose First</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f7;
            color: #1d1d1f;
        }

        header {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .toolbar {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .toolbar select {
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            background: white;
        }

        .toolbar button {
            padding: 0.5rem 1.5rem;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.875rem;
        }

        .toolbar button:hover {
            background: #2563eb;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 1.5rem;
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
            height: calc(100vh - 100px);
        }

        /* PROSE EDITOR - Main focus */
        .prose-panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .prose-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            font-weight: 600;
            font-size: 0.875rem;
            color: #6b7280;
            background: #f9fafb;
        }

        #prose-editor {
            flex: 1;
            padding: 3rem;
            font-family: Georgia, 'Times New Roman', serif;
            font-size: 16px;
            line-height: 1.8;
            color: #1f2937;
            outline: none;
            overflow-y: auto;
        }

        #prose-editor h1 {
            font-size: 32px;
            color: #111827;
            margin-bottom: 0.5rem;
            font-weight: 700;
            line-height: 1.2;
        }

        #prose-editor h2 {
            font-size: 13px;
            color: #6b7280;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 2rem;
        }

        #prose-editor p {
            margin-bottom: 1.5em;
        }

        .prose-highlight {
            background: rgba(251, 191, 36, 0.3);
            border-radius: 3px;
            padding: 2px 4px;
            transition: background 0.3s;
            animation: pulse 1s ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { background: rgba(251, 191, 36, 0.3); }
            50% { background: rgba(251, 191, 36, 0.6); }
        }

        /* ADVISOR PANEL - Guidance sidebar */
        .advisor-panel {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            overflow-y: auto;
        }

        .advisor-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .advisor-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            font-weight: 600;
            font-size: 0.875rem;
            color: #374151;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #f9fafb;
        }

        .score-display {
            font-size: 1.5rem;
            font-weight: 700;
            color: #3b82f6;
        }

        .advisor-content {
            padding: 1rem;
        }

        /* Recommendations */
        .rec-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .rec-item {
            padding: 0.75rem;
            background: #f9fafb;
            border-radius: 6px;
            font-size: 0.8125rem;
            line-height: 1.5;
            border-left: 3px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .rec-item:hover {
            background: #f3f4f6;
            transform: translateX(2px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .rec-item:active {
            transform: translateX(3px);
        }

        .rec-item.error {
            border-left-color: #ef4444;
            background: #fef2f2;
        }

        .rec-item.warning {
            border-left-color: #f59e0b;
            background: #fffbeb;
        }

        .rec-item.suggestion {
            border-left-color: #10b981;
            background: #f0fdf4;
        }

        .rec-label {
            font-weight: 600;
            color: #111827;
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .rec-description {
            color: #6b7280;
            font-size: 0.75rem;
        }

        .rec-field {
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.7rem;
            color: #9ca3af;
            margin-top: 0.25rem;
        }

        .rec-suggestion a {
            color: #3b82f6;
            text-decoration: underline;
            font-weight: 600;
        }

        .rec-suggestion a:hover {
            color: #2563eb;
        }

        .rec-suggestion pre {
            user-select: all;
            cursor: pointer;
        }

        .rec-suggestion pre:hover {
            background: #e5e7eb !important;
        }

        /* JSON-LD Preview (collapsible) */
        .jsonld-preview {
            max-height: 300px;
            overflow-y: auto;
            background: #0f172a;
            color: #e2e8f0;
            padding: 1rem;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 11px;
            line-height: 1.6;
            border-radius: 6px;
        }

        .json-key { color: #a78bfa; font-weight: 500; }
        .json-string { color: #34d399; }
        .json-bracket { color: #94a3b8; font-weight: 600; }
        .json-colon { color: #94a3b8; }
        .json-comma { color: #64748b; }
        .json-empty {
            color: #fca5a5;
            background: rgba(239, 68, 68, 0.25);
            padding: 3px 6px;
            border-radius: 4px;
            border: 1px dashed #ef4444;
            font-weight: 600;
        }

        .json-highlight {
            background: rgba(251, 191, 36, 0.4);
            padding: 3px 6px;
            border-radius: 4px;
            animation: pulse 1s ease-in-out;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
        }

        .stat-item {
            text-align: center;
            padding: 0.75rem;
            background: #f9fafb;
            border-radius: 6px;
        }

        .stat-number {
            display: block;
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e40af;
        }

        .stat-label {
            display: block;
            font-size: 0.7rem;
            color: #6b7280;
            margin-top: 0.25rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .expand-toggle {
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            font-size: 0.875rem;
            padding: 0.25rem;
        }

        .expand-toggle:hover {
            color: #374151;
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible-content.expanded {
            max-height: 400px;
        }
    </style>
</head>
<body>
    <header>
        <h1>üìù Campaign Content Editor</h1>
        <div class="toolbar">
            <select id="content-type">
                <option value="press">Press Release</option>
                <option value="speech">Speech</option>
                <option value="person">Person/Bio</option>
                <option value="issues">Issues Page</option>
                <option value="event">Event</option>
                <option value="qapage">Q&A Page</option>
                <option value="faqpage">FAQ Page</option>
            </select>
            <button id="analyze-btn">üîç Analyze Content</button>
        </div>
    </header>

    <div class="container">
        <!-- MAIN: Prose Editor -->
        <div class="prose-panel">
            <div class="prose-header">‚úçÔ∏è Your Campaign Content</div>
            <div contenteditable="true" id="prose-editor" spellcheck="true">
                <h1>Emma Carter Unveils Plan to Expand Affordable Housing in CA-15</h1>
                <h2>Oakland, CA ‚Äî October 14, 2025</h2>
                <p>Congressional candidate Emma Carter today announced a comprehensive plan to address the Bay Area's affordable housing crisis, proposing new funding mechanisms and zoning reforms that would create 15,000 affordable units across California's 15th District over the next five years.</p>
                <p>Speaking at a press conference outside Oakland City Hall, Carter outlined her three-pillar approach: expanding Community Land Trusts to preserve affordable units in perpetuity, streamlining permitting processes for affordable housing developers, and establishing a regional housing trust fund with contributions from large corporations.</p>
                <p>"Working families in our district are being priced out of their own neighborhoods," Carter said. "Over 60% of renters in CA-15 are now rent-burdened, paying more than 30% of their income on housing. This is unsustainable, and we need bold federal action to support local solutions."</p>
                <p>The plan has already garnered support from the East Bay Housing Organizations coalition and the California Teachers Association, who praised Carter's focus on preserving naturally occurring affordable housing alongside new construction.</p>
                <p>"Emma understands that we can't build our way out of this crisis alone‚Äîwe need to protect the affordable housing we already have," said Maria Gonzalez, Executive Director of Oakland Community Housing. "Her Community Land Trust proposal is exactly what we need."</p>
                <p>Her opponent has a different record on housing policy.</p>
                <p>The full plan will be available on Carter's campaign website starting today, and she will host a community forum on housing policy this Saturday at Oakland Technical High School.</p>
                <p>###</p>
            </div>
        </div>

        <!-- SIDEBAR: AI Advisor -->
        <div class="advisor-panel">
            <!-- Completeness Score -->
            <div class="advisor-card">
                <div class="advisor-header">
                    <span>üéØ AI Completeness</span>
                    <span class="score-display" id="completeness-score">--</span>
                </div>
                <div class="advisor-content">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-number" id="error-count">--</span>
                            <span class="stat-label">Errors</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="warning-count">--</span>
                            <span class="stat-label">Warnings</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="ok-count">--</span>
                            <span class="stat-label">Complete</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recommendations -->
            <div class="advisor-card">
                <div class="advisor-header">
                    <span>üí° Recommendations</span>
                    <span style="font-size: 0.7rem; font-weight: normal; color: #9ca3af;">Click to highlight</span>
                </div>
                <div class="advisor-content">
                    <div class="rec-list" id="recommendations-list">
                        <p style="color: #9ca3af; font-size: 0.8125rem; text-align: center; padding: 1rem;">
                            Click "Analyze Content" to see recommendations
                        </p>
                    </div>
                </div>
            </div>

            <!-- JSON-LD Preview (collapsible) -->
            <div class="advisor-card">
                <div class="advisor-header">
                    <span>‚öôÔ∏è JSON-LD Preview</span>
                    <button class="expand-toggle" onclick="toggleJsonPreview()">‚ñº</button>
                </div>
                <div class="collapsible-content" id="jsonld-container">
                    <div class="advisor-content">
                        <div class="jsonld-preview" id="jsonld-preview">
                            <span style="color: #64748b;">Click "Analyze Content" to generate</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleJsonPreview() {
            const container = document.getElementById('jsonld-container');
            container.classList.toggle('expanded');
        }

        // Content templates
        const templates = {
            speech: {
                prose: `<h1>Remarks by Emma Carter at Oakland Labor Day Rally</h1>
<h2>Remarks as prepared for delivery</h2>
<p>Thank you so much for that warm welcome. It's an honor to be here with so many workers, organizers, and union members who are fighting every day for dignity on the job.</p>
<p>I'm running for Congress because I believe that work should pay. I believe that if you put in a full day's work, you should be able to afford a roof over your head, food on your table, and a little bit left over to save for the future. But that's not the reality for too many working families in our district right now.</p>
<p>The cost of living keeps going up, but wages aren't keeping pace. Families are working harder than ever, but they're still struggling to make ends meet. That's not right, and it doesn't have to be this way.</p>
<p>When I talk to workers across CA-15, I hear the same concerns over and over. Teachers who can't afford to live in the communities where they teach. Healthcare workers who are stretched thin and burned out. Service workers juggling two or three jobs just to pay rent.</p>
<p>My opponent talks about the economy like it's doing great. But whose economy is he talking about? Because the economy I see‚Äîthe one working families are living in‚Äîlooks very different.</p>
<p>We need leaders in Washington who understand that a strong economy means strong wages, strong unions, and strong protections for workers. That's the economy I'll fight for in Congress.</p>
<p>I'll fight to raise the minimum wage to $20 an hour, because nobody working full-time should be living in poverty. I'll fight to protect your right to organize and collectively bargain. And I'll fight to ensure that every worker has access to paid sick leave, paid family leave, and a secure retirement.</p>
<p>This campaign is about you. It's about the nurse working the night shift. The teacher buying school supplies out of their own pocket. The union electrician building our future. You deserve a representative who will show up for you the way you show up for our community every single day.</p>
<p>Together, we can build an economy that works for everyone, not just the wealthy and well-connected. Together, we can win this race and bring real change to Washington.</p>
<p>Thank you, and let's get to work!</p>`,
                schema: 'Article'
            },
            press: {
                prose: `<h1>Emma Carter Unveils Plan to Expand Affordable Housing in CA-15</h1>
<h2>Oakland, CA ‚Äî October 14, 2025, 9:00 AM PT</h2>
<p>Congressional candidate Emma Carter today announced a comprehensive plan to address the Bay Area's affordable housing crisis, proposing new funding mechanisms and zoning reforms that would create 15,000 affordable units across California's 15th District over the next five years.</p>
<p>Speaking at a press conference outside Oakland City Hall, Carter outlined her three-pillar approach: expanding Community Land Trusts to preserve affordable units in perpetuity, streamlining permitting processes for affordable housing developers, and establishing a regional housing trust fund with contributions from large corporations.</p>
<p>"Working families in our district are being priced out of their own neighborhoods," Carter said. "According to recent data from the Bay Area Housing Coalition, over 60% of renters in CA-15 are now rent-burdened, paying more than 30% of their income on housing. This is unsustainable, and we need bold federal action to support local solutions."</p>
<p>The plan has already garnered support from the East Bay Housing Organizations coalition and the California Teachers Association, who praised Carter's focus on preserving naturally occurring affordable housing alongside new construction.</p>
<p>"Emma understands that we can't build our way out of this crisis alone‚Äîwe need to protect the affordable housing we already have," said Maria Gonzalez, Executive Director of Oakland Community Housing. "Her Community Land Trust proposal is exactly what we need."</p>
<p>Carter's opponent, incumbent Representative John Doe, has previously voted against federal affordable housing funding bills, including the 2024 Housing Investment Act.</p>
<p>The full plan will be available on Carter's campaign website starting today, and she will host a community forum on housing policy this Saturday at Oakland Technical High School.</p>
<p>###</p>
<p>Contact: press@emmacarterforcongress.org</p>`,
                schema: 'NewsArticle'
            },
            person: {
                prose: `<h1>About Emma Carter</h1>
<h2>Candidate for U.S. House, California's 15th District</h2>
<p>Emma Carter is a Democrat running for Congress to fight for working families, affordable housing, and climate action in California's 15th District.</p>
<p>Born and raised in Oakland, Emma has spent her entire career fighting for her community. As a small business owner for over 15 years, she understands the challenges facing local entrepreneurs. As a community organizer with the East Bay Housing Coalition, she's helped hundreds of families stay in their homes and advocated for tenant protections at the state level.</p>
<p>Emma serves on the Oakland Planning Commission, where she's been a leading voice for sustainable development and affordable housing. She also volunteers with Youth UpRising, mentoring young people interested in civic engagement and social justice.</p>
<p>Emma graduated from UC Berkeley with a degree in Urban Studies and earned her MBA from Stanford's Graduate School of Business. She lives in Oakland's Fruitvale neighborhood with her partner and their rescue dog, Bailey.</p>
<p>In Congress, Emma will fight to:</p>
<p>‚Ä¢ Expand affordable housing and protect tenants' rights<br>‚Ä¢ Take bold action on climate change and create clean energy jobs<br>‚Ä¢ Strengthen public education and make college affordable<br>‚Ä¢ Protect reproductive freedom and voting rights<br>‚Ä¢ Build an economy that works for working families, not just the wealthy</p>
<p>Learn more and get involved at emmacarterforcongress.org</p>`,
                schema: 'Person'
            },
            issues: {
                prose: `<h1>Where Emma Stands</h1>
<h2>Our Priorities for CA-15</h2>
<p><strong>Affordable Housing:</strong> The Bay Area's housing crisis is pricing working families out of their own neighborhoods. Emma will fight for federal funding to build 15,000 new affordable units in CA-15, expand Community Land Trusts, and protect tenants from predatory landlords. She supports the Homes for All Act and will work to preserve naturally occurring affordable housing while streamlining construction of new units.</p>
<p><strong>Climate Action:</strong> We don't have time for half-measures. Emma supports the Green New Deal and will fight for massive investments in clean energy, public transit, and green jobs. She'll push to make the Bay Area a national leader in climate solutions, from expanding BART to weatherizing every home in our district. Climate action is economic justice‚Äîand Emma will ensure the transition to clean energy creates good union jobs.</p>
<p><strong>Education:</strong> Every child deserves access to excellent public schools, from pre-K through college. Emma will fight to fully fund public education, raise teacher pay, expand universal pre-K, and make public colleges tuition-free for working families. She opposes school privatization and will work to cancel student debt that's crushing a generation of young people.</p>`,
                schema: 'WebPage'
            },
            event: {
                prose: `<h1>Community Rally: Fighting for Our Future</h1>
<h2>Saturday, October 20, 2025 ‚Ä¢ 2:00 PM - 4:00 PM PT</h2>
<p>Join Emma Carter and special guests for a community rally at Jack London Square! We'll be rallying together to kick off the final months of our campaign and energize our grassroots movement for affordable housing, climate action, and economic justice.</p>
<p>This free, family-friendly event will feature:</p>
<p>‚Ä¢ Speeches from Emma and local labor and community leaders<br>‚Ä¢ Live music from Oakland artists<br>‚Ä¢ Activities for kids<br>‚Ä¢ Voter registration<br>‚Ä¢ Opportunities to sign up to volunteer</p>
<p><strong>Location:</strong> Jack London Square Amphitheater, 55 Harrison Street, Oakland, CA 94607</p>
<p><strong>Accessibility:</strong> This event is wheelchair accessible with ASL interpretation available. For other accessibility needs, please email events@emmacarterforcongress.org at least 48 hours in advance.</p>
<p>Can't make it? Sign up to volunteer at other events at emmacarterforcongress.org/volunteer</p>
<p>RSVP today at emmacarterforcongress.org/rally</p>`,
                schema: 'Event'
            },
            qapage: {
                prose: `<h1>Where do you stand on reproductive rights?</h1>
<h2>Voter Questions Answered</h2>
<p><strong>Question:</strong> Many voters in CA-15 have asked how Emma Carter would protect reproductive freedom if elected to Congress.</p>
<p><strong>Emma's Answer:</strong> I will always fight to protect reproductive freedom. Every person deserves the right to make their own healthcare decisions without government interference. The Supreme Court's decision to overturn Roe v. Wade was devastating, and we cannot sit by while extremist politicians ban abortion nationwide.</p>
<p>In Congress, I will:</p>
<p>‚Ä¢ Vote to codify Roe v. Wade protections into federal law<br>‚Ä¢ Oppose any national abortion ban<br>‚Ä¢ Protect access to reproductive healthcare, including contraception and IVF<br>‚Ä¢ Ensure medication abortion remains accessible<br>‚Ä¢ Fight to repeal the Hyde Amendment so every person can access abortion care regardless of income</p>
<p>Reproductive freedom is fundamental to economic freedom, bodily autonomy, and equality. I trust people to make their own healthcare decisions‚Äînot politicians.</p>`,
                schema: 'QAPage'
            },
            faqpage: {
                prose: `<h1>Frequently Asked Questions</h1>
<h2>Everything you need to know about Emma's campaign</h2>
<p><strong>How can I volunteer?</strong> We'd love your help! Sign up at emmacarterforcongress.org/volunteer to join our team. We have opportunities for phone banking, canvassing, event support, data entry, social media, and more. No experience necessary‚Äîwe'll train you! Volunteer shifts are available weekdays, evenings, and weekends.</p>
<p><strong>How do I donate?</strong> You can donate online at emmacarterforcongress.org/donate using a credit card or PayPal. We also accept donations by check made out to "Emma Carter for Congress" and mailed to: PO Box 12345, Oakland, CA 94612. Please include your occupation and employer (required by FEC rules). The maximum individual contribution is $3,300 for the primary and $3,300 for the general election.</p>
<p><strong>Does Emma accept corporate PAC money?</strong> No. Emma has pledged not to accept contributions from corporate PACs. This campaign is funded by grassroots donors like you‚Äîour average online donation is $27. We're proud to be a people-powered campaign.</p>
<p><strong>When is the election?</strong> The primary election is March 5, 2026, and the general election is November 3, 2026. Make sure you're registered to vote at registertovote.ca.gov. The voter registration deadline is February 18, 2026 for the primary.</p>
<p><strong>What district is Emma running in?</strong> Emma is running for California's 15th Congressional District, which includes Oakland, San Leandro, Alameda, and parts of the East Bay. You can check if you're in CA-15 at emmacarterforcongress.org/district-map</p>
<p><strong>How can I request a yard sign?</strong> Fill out the form at emmacarterforcongress.org/yard-sign or email signs@emmacarterforcongress.org with your name and address. Signs are free, and we'll deliver them to your neighborhood. We also have window signs available for apartments.</p>
<p><strong>Can I host a house party or event?</strong> Absolutely! House parties are a great way to introduce Emma to your friends and neighbors. Email events@emmacarterforcongress.org to get started. We'll provide materials, talking points, and sometimes Emma can attend in person or via video call.</p>
<p><strong>What is Emma's position on climate change?</strong> Emma supports the Green New Deal and bold climate action. She'll fight for massive investments in clean energy, public transit expansion, and green jobs. Climate action is economic justice‚ÄîEmma will ensure the transition creates good union jobs in our community.</p>
<p><strong>Where does Emma stand on healthcare?</strong> Emma supports Medicare for All as the ultimate goal, and will fight for a public option as an immediate step. She believes healthcare is a human right, not a privilege. Emma will work to lower prescription drug costs and expand access to mental health services.</p>
<p><strong>How can I get Emma's position on a specific issue?</strong> Visit emmacarterforcongress.org/issues for detailed policy positions. You can also email policy@emmacarterforcongress.org with specific questions, and we'll get back to you within 48 hours.</p>
<p><strong>Is Emma running against an incumbent?</strong> Yes, Emma is challenging incumbent Representative John Doe, who has voted against affordable housing funding, climate action, and workers' rights. Emma believes our district deserves a representative who fights for working families, not corporate interests.</p>
<p><strong>How can I stay updated on the campaign?</strong> Sign up for our email list at emmacarterforcongress.org, follow us on Twitter @EmmaCarterCA15, Facebook @EmmaCarterForCongress, and Instagram @emmacarterf orca15. We send weekly updates with campaign news, volunteer opportunities, and event invitations.</p>`,
                schema: 'FAQPage'
            }
        };

        const proseEditor = document.getElementById('prose-editor');
        const contentTypeSelect = document.getElementById('content-type');
        const analyzeBtn = document.getElementById('analyze-btn');

        // Load template on content type change
        contentTypeSelect.addEventListener('change', () => {
            const type = contentTypeSelect.value;
            if (templates[type]) {
                proseEditor.innerHTML = templates[type].prose;
            }
        });

        // Analyze button
        analyzeBtn.addEventListener('click', () => {
            const prose = proseEditor.innerText;
            const contentType = contentTypeSelect.value;

            // Generate JSON-LD first
            const jsonld = generateJSONLD(prose, contentType);

            // Generate recommendations based on mockup validation rules AND missing JSON-LD fields
            const recommendations = analyzeContent(prose, contentType, jsonld);
            displayRecommendations(recommendations);

            displayJSONLD(jsonld);

            // Calculate score
            const score = calculateScore(recommendations);
            displayScore(score, recommendations);
        });

        function analyzeContent(prose, contentType, jsonld) {
            const recs = { errors: [], warnings: [], suggestions: [] };

            // First, check for MISSING values in JSON-LD and generate recommendations
            const jsonString = JSON.stringify(jsonld);
            const missingMatches = jsonString.match(/<< MISSING: ([^>]+) >>/g);

            if (missingMatches) {
                missingMatches.forEach(match => {
                    const description = match.replace(/<< MISSING: /, '').replace(/ >>/, '');

                    // Determine field from the description
                    if (description.includes('hero image') || description.includes('headshot')) {
                        recs.errors.push({
                            label: 'Missing image URL',
                            description: description,
                            field: 'image',
                            suggestion: 'Upload image and add URL to metadata (images aren\'t added in prose)'
                        });
                    } else if (description.includes('logo')) {
                        recs.warnings.push({
                            label: 'Missing campaign logo',
                            description: description,
                            field: 'publisher.logo',
                            suggestion: 'Upload campaign logo and add URL to metadata'
                        });
                    } else if (description.includes('summary') || description.includes('first paragraph')) {
                        recs.errors.push({
                            label: 'Missing description/summary',
                            description: description,
                            field: 'description',
                            suggestion: 'Ensure first paragraph is substantial (100+ words) and summarizes the news'
                        });
                    } else if (description.includes('date') || description.includes('time')) {
                        recs.errors.push({
                            label: 'Missing or incomplete date/time',
                            description: description,
                            field: 'datePublished',
                            suggestion: 'Add complete dateline: "City, State ‚Äî Month Day, Year, Time AM/PM TZ"'
                        });
                    } else if (description.includes('party affiliation')) {
                        recs.errors.push({
                            label: 'Missing party affiliation in prose',
                            description: description,
                            field: 'memberOf.name',
                            suggestion: 'Add to first sentence: "...is a Democrat/Republican running for..."'
                        });
                    } else if (description.includes('street address')) {
                        recs.errors.push({
                            label: 'Missing complete address',
                            description: description,
                            field: 'location.address',
                            suggestion: 'Add full address: "Building, Street Number Street Name, City, State ZIP"'
                        });
                    }
                });
            }

            if (contentType === 'press') {
                const lines = prose.split('\n').filter(l => l.trim());

                // ‚ùå Required: headline ‚â§110 chars
                const headlineText = lines[0] || '';
                if (!headlineText) {
                    recs.errors.push({
                        label: 'Missing headline',
                        description: 'Add press release headline',
                        field: 'headline',
                        suggestion: 'üìù Keep headline ‚â§110 characters for optimal display in search results'
                    });
                } else if (headlineText.length > 110) {
                    recs.warnings.push({
                        label: 'Headline too long',
                        description: `Headline is ${headlineText.length} chars, should be ‚â§110`,
                        field: 'headline',
                        suggestion: `üìù Shorten to: "${headlineText.substring(0, 90)}..." (${headlineText.length - 90} chars to cut)`
                    });
                }

                // ‚ùå Required: description (DEK) 120-200 chars
                const firstPara = lines[2] || '';
                if (!firstPara || firstPara.length < 80) {
                    recs.errors.push({
                        label: 'Missing or weak summary/DEK',
                        description: 'First paragraph should be 120-200 characters summarizing the news',
                        field: 'description',
                        suggestion: 'üìù Add lede paragraph: who, what, when, where, why (100-150 words recommended)'
                    });
                } else if (firstPara.length < 120) {
                    recs.warnings.push({
                        label: 'Summary/DEK too short',
                        description: `First paragraph is ${firstPara.length} chars, target 120-200 for description field`,
                        field: 'description',
                        suggestion: 'üìù Expand to include key details: location, specific actions, expected impact'
                    });
                } else if (firstPara.length > 200) {
                    recs.warnings.push({
                        label: 'Summary/DEK too long',
                        description: `First paragraph is ${firstPara.length} chars, target 120-200 for optimal meta description`,
                        field: 'description',
                        suggestion: `üìù Trim to: "${firstPara.substring(0, 180)}..."`
                    });
                }

                // ‚ùå Required: datePublished in ISO 8601 with timezone
                const hasDateline = prose.includes('‚Äî') && prose.match(/\d{4}/);
                const hasTime = prose.match(/\d{1,2}:\d{2}\s*(AM|PM|am|pm)/i);

                if (!hasDateline) {
                    recs.errors.push({
                        label: 'Missing publication date',
                        description: 'Add dateline after headline with full date and time',
                        field: 'datePublished',
                        suggestion: 'üìù Format: "Oakland, CA ‚Äî October 14, 2025, 9:00 AM PT"'
                    });
                } else if (!hasTime) {
                    const dateline = lines.find(l => l.includes('‚Äî')) || '';
                    recs.warnings.push({
                        label: 'Add time to dateline',
                        description: `Complete dateline "${dateline.substring(0, 50)}..." needs time`,
                        field: 'datePublished',
                        suggestion: '‚ö†Ô∏è ISO 8601 requires: YYYY-MM-DDThh:mm:ss¬±TZ | üìù Add: "9:00 AM PT"'
                    });
                }

                // ‚ö†Ô∏è Recommended: articleSection (taxonomy)
                const hasSection = prose.match(/press release|statement|news/i);
                const sectionType = prose.toLowerCase().includes('statement') ? 'Statements' : 'Press Releases';

                if (!hasSection) {
                    recs.suggestions.push({
                        label: 'Add article section taxonomy',
                        description: 'Categorize as "Press Releases", "Statements", or "News"',
                        field: 'articleSection',
                        suggestion: `üìã Add to JSON-LD: "articleSection": "${sectionType}"`
                    });
                }

                // ‚ö†Ô∏è Recommended: author.name (campaign committee)
                const hasAuthor = prose.toLowerCase().includes('emma carter for congress') ||
                                 prose.toLowerCase().includes('campaign');

                if (!hasAuthor) {
                    recs.warnings.push({
                        label: 'Add author/publisher attribution',
                        description: 'Specify campaign committee as author',
                        field: 'author.name',
                        suggestion: 'üìã JSON-LD: { "@type": "Organization", "name": "Emma Carter for Congress" }'
                    });
                }

                // ‚ö†Ô∏è Recommended: image[] (hero image ‚â•1200px)
                const hasImageRef = prose.toLowerCase().includes('image') || prose.toLowerCase().includes('photo');

                recs.warnings.push({
                    label: 'Add hero image URL',
                    description: 'Press releases should include a high-resolution image (‚â•1200px)',
                    field: 'image',
                    suggestion: 'üìã Upload image and add: "image": ["https://emmacarterforcongress.org/images/press/...jpg"]'
                });

                // ‚ö†Ô∏è Recommended: citation[] for data claims
                const hasDataClaim = prose.match(/\d+%|percent|\$\d+/i);
                const hasCitation = prose.includes('(Source:') || prose.includes('according to') || prose.includes('data from');

                if (hasDataClaim && !hasCitation) {
                    const match = prose.match(/("[^"]*\d+%[^"]*"|[^\."]*\d+%[^\."]*)/);
                    if (match) {
                        const excerpt = match[0].substring(0, 60).replace(/^[^a-zA-Z0-9"]*/, '').replace(/"/g, '');
                        const searchQuery = encodeURIComponent(excerpt);
                        const webSearch = `https://www.google.com/search?q=${searchQuery}+statistics+source`;

                        // Suggest likely authoritative sources based on topic
                        let suggestedSources = 'Census Bureau, HUD, local housing authority';
                        if (excerpt.toLowerCase().includes('housing')) {
                            suggestedSources = 'Bay Area Housing Coalition, HUD, California Housing Partnership';
                        } else if (excerpt.toLowerCase().includes('job')) {
                            suggestedSources = 'Bureau of Labor Statistics, EDD, local workforce board';
                        }

                        recs.warnings.push({
                            label: 'Add citation for data claim',
                            description: `Need source for: "${excerpt}..."`,
                            field: 'citation',
                            suggestion: `üîç <a href="${webSearch}" target="_blank">Search for this statistic</a> | üí° Try: ${suggestedSources} | ‚úâÔ∏è Request from research team | üìã Add inline: "(Source: [Organization], [Year])" and to JSON-LD citation: ["https://..."]`,
                            actionable: true
                        });
                    }
                }

                // ‚úÖ Optional: about (linkage to candidate Person)
                const hasCandidateMention = prose.toLowerCase().includes('emma carter');

                if (hasCandidateMention) {
                    recs.suggestions.push({
                        label: 'Link to candidate Person schema',
                        description: 'Connect press release to candidate bio',
                        field: 'about',
                        suggestion: 'üìã Add to JSON-LD: "about": { "@type": "Person", "name": "Emma Carter", "@id": "https://emmacarterforcongress.org/candidate" }',
                        actionable: true
                    });
                }

                // Check for media contact info (only if missing)
                const hasContact = prose.toLowerCase().includes('contact:') ||
                                   prose.match(/\w+@\w+\.\w+/) ||
                                   prose.match(/\d{3}-\d{3}-\d{4}/);

                if (!hasContact) {
                    recs.suggestions.push({
                        label: 'Add media contact info',
                        description: 'After "###", add: "Contact: press@emmacarterforcongress.org"',
                        field: 'publisher.contactPoint',
                        suggestion: 'Helps journalists reach campaign for follow-up questions'
                    });
                }

            } else if (contentType === 'person') {
                // Person/Bio validation based on Person JSON-LD schema

                // ‚ùå Required: name
                const lines = prose.split('\n').filter(l => l.trim());
                const candidateName = lines[0] || '';
                if (!candidateName || candidateName.length < 5) {
                    recs.errors.push({
                        label: 'Missing candidate name',
                        description: 'Add candidate full name in headline',
                        field: 'name',
                        suggestion: 'Example: "About Emma Carter" or "Emma Carter for Congress"'
                    });
                }

                // ‚ùå Required: about.name (office/district)
                const hasOffice = prose.match(/(?:candidate for|running for)\s+([^,\n\.]+)/i) ||
                                 prose.match(/(U\.S\.\s+(?:House|Senate)[^,\n\.]*)/i) ||
                                 prose.match(/(Congress[^,\n\.]*)/i);

                if (!hasOffice) {
                    recs.errors.push({
                        label: 'Missing office/district information',
                        description: 'Specify what office the candidate is running for',
                        field: 'about.name',
                        suggestion: 'üìù Add: "Candidate for U.S. House, California\'s 15th District"'
                    });
                }

                // ‚ö†Ô∏è Recommended: memberOf.name (party affiliation)
                const hasParty = prose.toLowerCase().includes('democrat') || prose.toLowerCase().includes('republican');
                if (!hasParty) {
                    const firstSentence = prose.split(/[.!?]/)[0];
                    recs.warnings.push({
                        label: 'Add party affiliation',
                        description: `Specify party in introduction`,
                        field: 'memberOf.name',
                        suggestion: `üìù Replace "${firstSentence.substring(0, 40)}..." with: "Emma Carter is a Democrat running for..."`,
                        actionable: true
                    });
                }

                // ‚ö†Ô∏è Recommended: potentialAction (donate & volunteer)
                const hasDonate = prose.match(/donate|contribute|chip in/i);
                const hasVolunteer = prose.match(/volunteer|get involved|join/i);

                if (!hasDonate) {
                    recs.warnings.push({
                        label: 'Add donate call-to-action',
                        description: 'Include link to donation page',
                        field: 'potentialAction.DonateAction',
                        suggestion: 'üîó Add to JSON-LD: { "@type": "DonateAction", "target": { "@type": "EntryPoint", "urlTemplate": "https://emmacarterforcongress.org/donate" } }',
                        actionable: true
                    });
                }

                if (!hasVolunteer) {
                    recs.warnings.push({
                        label: 'Add volunteer call-to-action',
                        description: 'Include link to volunteer signup',
                        field: 'potentialAction.JoinAction',
                        suggestion: 'üîó Add to JSON-LD: { "@type": "JoinAction", "target": { "@type": "EntryPoint", "urlTemplate": "https://emmacarterforcongress.org/volunteer" } }',
                        actionable: true
                    });
                }

                // ‚ö†Ô∏è Recommended: sameAs[] (social links)
                const hasSocial = prose.match(/twitter|facebook|instagram|youtube|linkedin/i) ||
                                 prose.match(/https?:\/\/(twitter|facebook|instagram|youtube|linkedin)/i);

                if (!hasSocial) {
                    const socialSnippet = JSON.stringify([
                        "https://emmacarterforcongress.org",
                        "https://twitter.com/emmacarter",
                        "https://facebook.com/emmacarter",
                        "https://instagram.com/emmacarter"
                    ], null, 2);

                    recs.warnings.push({
                        label: 'Add social media links',
                        description: 'Include official social media profiles',
                        field: 'sameAs',
                        suggestion: `üìã Copy to sameAs[] in JSON-LD:\n<pre style="background:#f3f4f6;padding:0.5rem;margin:0.5rem 0;border-radius:4px;font-size:0.7rem;overflow-x:auto;">${socialSnippet}</pre>`,
                        actionable: true
                    });
                }

                // ‚ö†Ô∏è Recommended: identifier (FEC ID)
                const hasFEC = prose.match(/FEC|C00\d{6}/i);
                if (!hasFEC) {
                    recs.suggestions.push({
                        label: 'Add FEC identifier (if available)',
                        description: 'Federal Election Commission ID for transparency',
                        field: 'identifier',
                        suggestion: 'üîç <a href="https://www.fec.gov/data/candidates/" target="_blank">Search FEC database</a> | üìã Add: identifier: [{ "@type": "PropertyValue", "propertyID": "FEC", "value": "C00XXXXXX" }]',
                        actionable: true
                    });
                }

                // Suggest adding bio elements if missing
                const hasEducation = prose.toLowerCase().includes('graduated') ||
                                    prose.toLowerCase().includes('degree') ||
                                    prose.toLowerCase().includes('university') ||
                                    prose.toLowerCase().includes('college');

                if (!hasEducation) {
                    recs.suggestions.push({
                        label: 'Add educational background',
                        description: 'Educational credentials build credibility',
                        field: 'alumniOf',
                        suggestion: 'üìù Add after work experience: "Emma graduated from [University] with a degree in [Field]"'
                    });
                }

                const hasResidency = prose.toLowerCase().includes('lives in') ||
                                    prose.toLowerCase().includes('resident of') ||
                                    prose.toLowerCase().includes('hometown') ||
                                    prose.toLowerCase().includes('born and raised');

                if (!hasResidency) {
                    recs.suggestions.push({
                        label: 'Add local residency',
                        description: 'Shows connection to the community',
                        field: 'homeLocation',
                        suggestion: 'üìù Add: "Emma lives in Oakland\'s Fruitvale neighborhood with her family"'
                    });
                }

            } else if (contentType === 'event') {
                // Check for full address (only if incomplete)
                const hasStreetAddress = prose.match(/\d+\s+[A-Za-z]+\s+(Street|St|Avenue|Ave|Road|Rd|Boulevard|Blvd)/);
                const hasZipCode = prose.match(/\d{5}/);

                if (!hasStreetAddress) {
                    recs.errors.push({
                        label: 'Add complete street address',
                        description: 'Include street number and name: "55 Harrison Street, Oakland, CA 94607"',
                        field: 'location.address',
                        suggestion: 'Google Maps and AI assistants need full street addresses, not just venue names'
                    });
                } else if (!hasZipCode) {
                    recs.warnings.push({
                        label: 'Add ZIP code to address',
                        description: 'Include ZIP code at end of address for precise location',
                        field: 'location.address.postalCode',
                        suggestion: 'Example: "Oakland, CA 94607"'
                    });
                }

                // Check for RSVP link (only if missing)
                const hasRSVP = prose.toLowerCase().includes('rsvp') ||
                               prose.toLowerCase().includes('register') ||
                               prose.toLowerCase().includes('sign up');

                if (!hasRSVP) {
                    recs.warnings.push({
                        label: 'Add RSVP call-to-action',
                        description: 'Add at end: "RSVP at emmacarterforcongress.org/events/[event-name]"',
                        field: 'offers.url',
                        suggestion: 'Makes it easy for supporters to confirm attendance'
                    });
                }

                // Check for accessibility info (only if missing)
                const hasAccessibility = prose.toLowerCase().includes('accessible') ||
                                        prose.toLowerCase().includes('accommodation') ||
                                        prose.toLowerCase().includes('wheelchair') ||
                                        prose.toLowerCase().includes('asl');

                if (!hasAccessibility) {
                    recs.suggestions.push({
                        label: 'Add accessibility information',
                        description: 'Add: "This event is wheelchair accessible with ASL interpretation. For other needs, email [address]"',
                        field: 'accessibilityFeature',
                        suggestion: 'Demonstrates commitment to inclusive, accessible events'
                    });
                }

            } else if (contentType === 'speech') {
                // Speech validation based on Speech JSON-LD schema requirements

                // ‚ùå Required: name/title ‚â§110 chars
                const lines = prose.split('\n').filter(l => l.trim());
                const title = lines[0] || '';
                if (!title) {
                    recs.errors.push({
                        label: 'Missing speech title',
                        description: 'Add headline with speech title (‚â§110 characters)',
                        field: 'name',
                        suggestion: 'Example: "Remarks at Oakland Clean Jobs Rally"'
                    });
                } else if (title.length > 110) {
                    recs.warnings.push({
                        label: 'Speech title too long',
                        description: `Title is ${title.length} chars, should be ‚â§110 for optimal display`,
                        field: 'name',
                        suggestion: 'Shorten to core message: "Clean Jobs in Oakland"'
                    });
                }

                // ‚ùå Required: datePublished in ISO 8601 format
                const hasDate = prose.match(/\w+ \d+,? \d{4}/);
                const hasTime = prose.match(/\d{1,2}:\d{2}\s*(AM|PM|am|pm)/i);

                if (!hasDate) {
                    recs.errors.push({
                        label: 'Missing speech date',
                        description: 'Add date in subtitle or header: "September 28, 2025"',
                        field: 'datePublished',
                        suggestion: 'Required for JSON-LD: YYYY-MM-DDThh:mm:ss¬±TZ format'
                    });
                } else if (!hasTime) {
                    recs.warnings.push({
                        label: 'Add time to speech date',
                        description: 'Include delivery time: "September 28, 2025, 7:00 PM PT"',
                        field: 'datePublished',
                        suggestion: 'Full ISO 8601 timestamp improves AI understanding of context'
                    });
                }

                // ‚ö†Ô∏è Recommended: location (venue/city)
                const hasLocation = prose.match(/at ([A-Z][^,\n]+)/i) || prose.match(/in (Oakland|San Francisco|[A-Z][a-z]+)/);

                if (!hasLocation) {
                    recs.warnings.push({
                        label: 'Add location/venue to speech',
                        description: 'Include where speech was delivered: "at Oakland City Hall" or "in Oakland, CA"',
                        field: 'location.name',
                        suggestion: 'Location context helps AI systems categorize and surface the speech'
                    });
                }

                // ‚ö†Ô∏è Recommended: citation[] for factual claims
                const hasFactualClaim = prose.match(/\d+%|percent|\$\d+|according to|studies show|data (shows?|reveals?)/i);
                const hasCitation = prose.includes('(Source:') || prose.includes('https://') || prose.includes('http://');

                if (hasFactualClaim && !hasCitation) {
                    // Extract the specific claim
                    const claim = prose.match(/(\d+%[^\.]*|\$\d+[^\.]*)/) || [];
                    const claimText = claim[0] || 'statistical claim';
                    const searchQuery = encodeURIComponent(claimText);
                    const webSearch = `https://www.google.com/search?q=${searchQuery}+source+statistics`;

                    recs.warnings.push({
                        label: 'Add citations for factual claims',
                        description: `Need source for: "${claimText}"`,
                        field: 'citation',
                        suggestion: `üîç <a href="${webSearch}" target="_blank">Search for statistics source</a> | ‚úâÔ∏è Request from research team: "Need authoritative source for: ${claimText}" | üìã Add to JSON-LD citation: ["https://..."]`,
                        actionable: true
                    });
                }

                // ‚ö†Ô∏è Recommended: isBasedOn[] for policy references
                const hasPolicy = prose.toLowerCase().includes('plan') ||
                                 prose.toLowerCase().includes('proposal') ||
                                 prose.toLowerCase().includes('agenda') ||
                                 prose.toLowerCase().includes('platform');

                if (hasPolicy) {
                    // Try to extract plan/policy name
                    const policyMatch = prose.match(/(clean\s+\w+\s+(?:plan|agenda|proposal)|[\w\s]+\s+plan)/i);
                    const policyName = policyMatch ? policyMatch[0] : 'this policy';
                    const searchQuery = encodeURIComponent(`Emma Carter ${policyName} PDF`);

                    recs.suggestions.push({
                        label: 'Link to supporting policy documents',
                        description: `Reference detected: "${policyName}"`,
                        field: 'isBasedOn',
                        suggestion: `üîç <a href="https://www.google.com/search?q=${searchQuery}" target="_blank">Search for policy PDF</a> | üìÑ Check campaign website policy section | üìã Add: isBasedOn: ["https://emmacarterforcongress.org/policy/...pdf"]`,
                        actionable: true
                    });
                }

                // ‚ö†Ô∏è Recommended: about[] and keywords for topical tags
                const hasTopics = prose.match(/(jobs|housing|climate|healthcare|education|infrastructure|economy)/gi);

                if (hasTopics && hasTopics.length > 0) {
                    const uniqueTopics = [...new Set(hasTopics.map(t => t.toLowerCase()))];
                    const jsonSnippet = JSON.stringify(uniqueTopics.slice(0, 3).map(t => ({ "@type": "DefinedTerm", "termCode": t })), null, 2);

                    recs.suggestions.push({
                        label: 'Add topical tags to JSON-LD',
                        description: `Auto-detected: ${uniqueTopics.join(', ')}`,
                        field: 'about',
                        suggestion: `üìã Copy this JSON to about[] field:\n<pre style="background:#f3f4f6;padding:0.5rem;margin:0.5rem 0;border-radius:4px;font-size:0.7rem;overflow-x:auto;">${jsonSnippet}</pre>`,
                        actionable: true
                    });
                }

                // Alignment check: Title should relate to content
                if (title) {
                    const titleWords = title.toLowerCase().split(/\s+/).filter(w => w.length > 3);
                    const contentLower = prose.toLowerCase();
                    const matchingWords = titleWords.filter(w => contentLower.includes(w));

                    if (titleWords.length > 2 && matchingWords.length < 2) {
                        recs.warnings.push({
                            label: 'Title-content alignment issue',
                            description: 'Speech title doesn\'t match transcript content',
                            field: 'name',
                            suggestion: 'Ensure title accurately reflects speech topics and themes'
                        });
                    }
                }
            } else if (contentType === 'qapage' || contentType === 'faqpage') {
                // Q&A and FAQ validation based on QAPage/FAQPage JSON-LD schema

                // Parse questions and answers from prose
                const questions = [];
                const paragraphs = prose.split('\n').filter(p => p.trim());

                // Extract Q&A pairs (looking for bold questions or "Question:"/"Answer:" patterns)
                for (let i = 0; i < paragraphs.length; i++) {
                    const para = paragraphs[i];

                    // Check if this is a question (starts with bold ** or contains "Question:")
                    if (para.match(/^<strong>|^\*\*|Question:/i)) {
                        const questionText = para.replace(/<\/?strong>/g, '').replace(/^\*\*|\*\*$/g, '').replace(/^Question:\s*/i, '').trim();
                        const nextPara = paragraphs[i + 1] || '';
                        const answerText = nextPara.replace(/^(Answer:|Emma's Answer:)\s*/i, '').trim();

                        questions.push({ question: questionText, answer: answerText });
                    }
                }

                if (contentType === 'qapage') {
                    // ‚ùå Required: mainEntity.name (question text)
                    const mainQuestion = questions[0]?.question || '';
                    if (!mainQuestion) {
                        recs.errors.push({
                            label: 'Missing question text',
                            description: 'Add clear question in headline or first paragraph',
                            field: 'mainEntity.name',
                            suggestion: 'Example: "Where do you stand on reproductive rights?"'
                        });
                    }

                    // ‚ùå Required: acceptedAnswer.text
                    const mainAnswer = questions[0]?.answer || '';
                    if (!mainAnswer) {
                        recs.errors.push({
                            label: 'Missing answer text',
                            description: 'Provide substantive answer to the question',
                            field: 'mainEntity.acceptedAnswer.text',
                            suggestion: 'Policy Q&A requires detailed position statement (100+ words)'
                        });
                    } else if (mainAnswer.split(/\s+/).length < 20) {
                        recs.warnings.push({
                            label: 'Answer is very short',
                            description: `Answer is ${mainAnswer.split(/\s+/).length} words, consider expanding to 100+ words`,
                            field: 'mainEntity.acceptedAnswer.text',
                            suggestion: 'Detailed answers help AI systems provide complete, accurate information'
                        });
                    }

                    // ‚ö†Ô∏è Recommended: citation[] for policy claims
                    const hasPolicyClaim = prose.match(/will|support|oppose|vote|fight for/i);
                    const hasCitation = prose.includes('https://') || prose.includes('http://');

                    if (hasPolicyClaim && !hasCitation) {
                        // Extract the topic for targeted search
                        const topic = policyTopics && policyTopics.length > 0
                            ? policyTopics[0].toLowerCase()
                            : questionText.toLowerCase();

                        const searchQuery = encodeURIComponent(`${topic} policy Emma Carter campaign`);
                        const webSearch = `https://www.google.com/search?q=${searchQuery}`;

                        recs.warnings.push({
                            label: 'Add citations for policy positions',
                            description: `Need source for "${topic}" policy position`,
                            field: 'mainEntity.acceptedAnswer.citation',
                            suggestion: `üîç <a href="${webSearch}" target="_blank">Search for sources</a> | ‚úâÔ∏è Request from policy team: "Need authoritative source for ${topic} position" | üìã Add to JSON-LD: citation: ["https://..."]`,
                            actionable: true
                        });
                    }

                    // ‚ö†Ô∏è Recommended: about[] for policy taxonomy
                    const policyTopics = prose.match(/(reproductive rights|healthcare|climate|housing|education|jobs|economy)/gi);
                    if (policyTopics && policyTopics.length > 0) {
                        const uniqueTopics = [...new Set(policyTopics.map(t => t.toLowerCase().replace(/\s+/g, '-')))];
                        const jsonSnippet = JSON.stringify(uniqueTopics.map(t => ({ "@type": "DefinedTerm", "termCode": t })), null, 2);

                        recs.suggestions.push({
                            label: 'Add policy taxonomy tags',
                            description: `Auto-detected topics: ${uniqueTopics.join(', ')}`,
                            field: 'about',
                            suggestion: `üìã Copy this JSON to about[] field:\n<pre style="background:#f3f4f6;padding:0.5rem;margin:0.5rem 0;border-radius:4px;font-size:0.7rem;overflow-x:auto;">${jsonSnippet}</pre>`,
                            actionable: true
                        });
                    }

                } else if (contentType === 'faqpage') {
                    // ‚ùå Required: At least one question with answer
                    if (questions.length === 0) {
                        recs.errors.push({
                            label: 'No Q&A pairs found',
                            description: 'Add questions and answers in format: <strong>Question?</strong> Answer text.',
                            field: 'mainEntity',
                            suggestion: 'FAQ pages require at least one complete Q&A pair'
                        });
                    }

                    // Check each question
                    questions.forEach((qa, idx) => {
                        if (!qa.question || qa.question.length < 5) {
                            recs.errors.push({
                                label: `Question ${idx + 1} missing or unclear`,
                                description: 'Each FAQ entry needs a clear question',
                                field: `mainEntity[${idx}].name`,
                                suggestion: 'Use concise, direct questions: "How can I volunteer?"'
                            });
                        }

                        if (!qa.answer || qa.answer.trim().length === 0) {
                            recs.errors.push({
                                label: `Answer ${idx + 1} is empty`,
                                description: `Question "${qa.question.substring(0, 40)}..." has no answer`,
                                field: `mainEntity[${idx}].acceptedAnswer.text`,
                                suggestion: 'Provide clear, actionable answer with URLs where appropriate'
                            });
                        } else if (qa.answer.split(/\s+/).length < 3) {
                            recs.warnings.push({
                                label: `Answer ${idx + 1} is very short`,
                                description: `Answer for "${qa.question.substring(0, 30)}..." is < 3 words`,
                                field: `mainEntity[${idx}].acceptedAnswer.text`,
                                suggestion: 'Expand to provide useful, complete information'
                            });
                        }
                    });

                    // Suggest adding more questions if only 1-2
                    if (questions.length > 0 && questions.length < 3) {
                        recs.suggestions.push({
                            label: 'Add more FAQ entries',
                            description: `Only ${questions.length} Q&A pair(s) found. Consider adding common questions`,
                            field: 'mainEntity',
                            suggestion: 'Typical FAQ: volunteer, donate, events, contact, policy positions (5-12 items)'
                        });
                    }
                }
            }

            // General CTA check (only if no website mentioned)
            const hasWebsite = prose.toLowerCase().includes('learn more at') ||
                              prose.toLowerCase().includes('visit') ||
                              prose.match(/\w+\.(?:org|com|net)/);

            if (!hasWebsite && contentType !== 'person') { // Person bios usually don't need CTA
                recs.suggestions.push({
                    label: 'Add website call-to-action',
                    description: 'End with: "Learn more at emmacarterforcongress.org"',
                    field: 'potentialAction',
                    suggestion: 'Drives traffic to website for donations, volunteering, and more info'
                });
            }

            // ALIGNMENT CHECK: H1 vs JSON-LD headline/name (Global principle from alignment doc)
            // This ensures visible content matches structured data (must_be_visible principle)
            const lines = prose.split('\n').filter(l => l.trim());
            const h1Text = lines[0] || '';

            let jsonHeadlineField = null;
            let jsonHeadlineValue = null;

            if (contentType === 'press' && jsonld.headline) {
                jsonHeadlineField = 'headline';
                jsonHeadlineValue = jsonld.headline;
            } else if (contentType === 'speech' && jsonld.name) {
                jsonHeadlineField = 'name';
                jsonHeadlineValue = jsonld.name;
            } else if (contentType === 'person' && jsonld.name) {
                jsonHeadlineField = 'name';
                jsonHeadlineValue = jsonld.name;
            } else if (contentType === 'event' && jsonld.name) {
                jsonHeadlineField = 'name';
                jsonHeadlineValue = jsonld.name;
            } else if (contentType === 'qapage' && jsonld.mainEntity && jsonld.mainEntity.name) {
                jsonHeadlineField = 'mainEntity.name';
                jsonHeadlineValue = jsonld.mainEntity.name;
            }

            if (h1Text && jsonHeadlineField && jsonHeadlineValue && !jsonHeadlineValue.includes('<< MISSING')) {
                // Normalize both for comparison (trim, handle truncation)
                const h1Normalized = h1Text.trim();
                const jsonNormalized = jsonHeadlineValue.trim();

                // Check if they differ (allowing for headline truncation at 110 chars)
                if (h1Normalized !== jsonNormalized && !jsonNormalized.startsWith(h1Normalized.substring(0, 110))) {
                    recs.warnings.push({
                        label: 'Alignment: H1 doesn\'t match JSON-LD',
                        description: `Visible H1 differs from JSON-LD ${jsonHeadlineField}`,
                        field: jsonHeadlineField,
                        suggestion: `‚ö†Ô∏è Alignment principle: visible headline must match JSON-LD<br>Visible: "${h1Normalized.substring(0, 60)}..."<br>JSON-LD: "${jsonNormalized.substring(0, 60)}..."<br>üìù Ensure they are identical or JSON-LD is properly truncated version`
                    });
                }
            }

            // ALIGNMENT CHECKS: Discouraged and should_not_exist fields (from alignment principles doc)
            // These check for fields that shouldn't appear on certain content types

            // Helper to check if a field exists in JSON-LD (recursively)
            function hasField(obj, fieldName) {
                if (!obj || typeof obj !== 'object') return false;
                if (fieldName in obj) return true;
                for (const key in obj) {
                    if (typeof obj[key] === 'object' && hasField(obj[key], fieldName)) {
                        return true;
                    }
                }
                return false;
            }

            // Define discouraged and should_not_exist fields per content type
            const alignmentRules = {
                press: {
                    discouraged: ['AggregateRating', 'Review', 'offers'],
                    should_not_exist: ['price', 'performer', 'eventStatus']
                },
                event: {
                    discouraged: ['AggregateRating', 'Review'],
                    should_not_exist: ['headline', 'articleSection']
                },
                person: {
                    discouraged: ['AggregateRating', 'Review'],
                    should_not_exist: ['eventStatus', 'offers']
                },
                issues: {
                    discouraged: ['AggregateRating', 'Review'],
                    should_not_exist: ['offers', 'price']
                },
                qapage: {
                    discouraged: ['AggregateRating', 'Review'],
                    should_not_exist: ['offers', 'price']
                },
                faqpage: {
                    discouraged: ['AggregateRating', 'Review'],
                    should_not_exist: ['offers', 'price']
                },
                speech: {
                    discouraged: ['AggregateRating', 'Review', 'offers'],
                    should_not_exist: ['price', 'eventStatus']
                }
            };

            const rules = alignmentRules[contentType];
            if (rules) {
                // Check for discouraged fields (warnings)
                rules.discouraged.forEach(field => {
                    if (hasField(jsonld, field)) {
                        recs.warnings.push({
                            label: `Alignment: ${field} discouraged`,
                            description: `${field} is not recommended for ${contentType} pages`,
                            field: field,
                            suggestion: `‚ö†Ô∏è Alignment principle: ${field} should not be used on ${contentType} pages unless clearly supported by visible content. Consider removing this field.`
                        });
                    }
                });

                // Check for should_not_exist fields (errors)
                rules.should_not_exist.forEach(field => {
                    if (hasField(jsonld, field)) {
                        recs.errors.push({
                            label: `Alignment: ${field} not allowed`,
                            description: `${field} is out of scope for ${contentType} pages`,
                            field: field,
                            suggestion: `üö´ Alignment principle: ${field} must not appear on ${contentType} pages. Remove this field from JSON-LD.`
                        });
                    }
                });
            }

            return recs;
        }

        function displayRecommendations(recs) {
            const list = document.getElementById('recommendations-list');
            const allRecs = [
                ...recs.errors.map(r => ({ ...r, type: 'error', icon: '‚ùå' })),
                ...recs.warnings.map(r => ({ ...r, type: 'warning', icon: '‚ö†Ô∏è' })),
                ...recs.suggestions.map(r => ({ ...r, type: 'suggestion', icon: '‚ú®' }))
            ];

            if (allRecs.length === 0) {
                list.innerHTML = '<p style="color: #10b981; text-align: center; padding: 1rem;">‚úÖ All recommendations addressed!</p>';
                return;
            }

            list.innerHTML = allRecs.map((rec, index) => {
                // Escape field for onclick attribute
                const escapedField = rec.field.replace(/'/g, "\\'");
                return `
                <div class="rec-item ${rec.type}"
                     data-field="${rec.field}"
                     data-search-text="${rec.searchText || ''}"
                     onclick="highlightRecommendation('${escapedField}', ${index})">
                    <div class="rec-label">${rec.icon} ${rec.label}</div>
                    <div class="rec-description">${rec.description}</div>
                    ${rec.suggestion ? `<div class="rec-suggestion" style="margin-top: 0.5rem; font-size: 0.75rem; color: #3b82f6; line-height: 1.6;">${rec.suggestion}</div>` : ''}
                    <div class="rec-field">${rec.field}</div>
                </div>
            `;
            }).join('');

            // Store recommendations for click handlers
            window.currentRecommendations = allRecs;
        }

        function generateJSONLD(prose, contentType) {
            const lines = prose.split('\n').filter(l => l.trim());
            const headline = lines[0] || '';
            const dateline = lines.find(l => l.includes('‚Äî')) || '';
            const dateMatch = dateline.match(/(\w+ \d+, \d{4})/);
            const timeMatch = dateline.match(/(\d{1,2}:\d{2}\s*(?:AM|PM))/i);

            if (contentType === 'press') {
                const firstPara = lines[2] || '';

                // Description: Target 120-200 chars (from first paragraph)
                let description = '';
                if (firstPara.length >= 120 && firstPara.length <= 200) {
                    description = firstPara;
                } else if (firstPara.length > 200) {
                    description = firstPara.substring(0, 180) + '...';
                } else if (firstPara.length > 0) {
                    description = firstPara; // Use what we have
                } else {
                    description = "<< MISSING: Add first paragraph (120-200 chars summarizing who, what, when, where, why) >>";
                }

                // Build ISO 8601 datePublished with timezone
                let isoDate = "<< MISSING: Add dateline with date and time (format: YYYY-MM-DDThh:mm:ss-07:00) >>";
                if (dateMatch && timeMatch) {
                    // Parse date: "October 14, 2025"
                    const dateStr = dateMatch[0];
                    const timeStr = timeMatch[0];

                    const months = {jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12};
                    const dateParts = dateStr.match(/(\w+)\s+(\d+),?\s+(\d{4})/);

                    if (dateParts) {
                        const monthNum = months[dateParts[1].toLowerCase().substring(0,3)];
                        const day = dateParts[2].padStart(2, '0');
                        const year = dateParts[3];

                        // Parse time: "9:00 AM PT"
                        const timeParts = timeStr.match(/(\d{1,2}):(\d{2})\s*(AM|PM)/i);
                        if (monthNum && timeParts) {
                            let hour = parseInt(timeParts[1]);
                            const min = timeParts[2];
                            const ampm = timeParts[3].toUpperCase();

                            // Convert to 24-hour
                            if (ampm === 'PM' && hour !== 12) hour += 12;
                            if (ampm === 'AM' && hour === 12) hour = 0;

                            isoDate = `${year}-${monthNum.toString().padStart(2,'0')}-${day}T${hour.toString().padStart(2,'0')}:${min}:00-07:00`;
                        }
                    }
                } else if (dateMatch) {
                    isoDate = `<< MISSING: Add time to dateline (format: "9:00 AM PT") >>`;
                }

                // Detect if statement vs press release
                const articleSection = prose.toLowerCase().includes('statement') ? 'Statements' : 'Press Releases';

                // Check if Emma Carter is mentioned for about linkage
                const hasCandidateMention = prose.toLowerCase().includes('emma carter');

                return {
                    "@context": "https://schema.org",
                    "@type": "NewsArticle",
                    "@id": "https://emmacarterforcongress.org/news/housing-plan",
                    "headline": headline.substring(0, 110), // Enforce ‚â§110 chars
                    "description": description,
                    "articleSection": articleSection,
                    "image": ["<< MISSING: Add hero image URL ‚â•1200px (e.g., https://emmacarterforcongress.org/images/press/housing-hero-1600.jpg) >>"],
                    "author": {
                        "@type": "Organization",
                        "name": "Emma Carter for Congress"
                    },
                    "about": hasCandidateMention ? {
                        "@type": "Person",
                        "name": "Emma Carter",
                        "@id": "https://emmacarterforcongress.org/candidate"
                    } : undefined,
                    "datePublished": isoDate,
                    "dateModified": isoDate, // Same as published unless updated later
                    "mainEntityOfPage": {
                        "@type": "WebPage",
                        "@id": "https://emmacarterforcongress.org/news/housing-plan"
                    },
                    "publisher": {
                        "@type": "Organization",
                        "name": "Emma Carter for Congress",
                        "logo": {
                            "@type": "ImageObject",
                            "url": "<< MISSING: Add campaign logo URL ‚â•120x60px >>"
                        }
                    },
                    "citation": prose.match(/\d+%|percent/i) ? ["<< MISSING: Add source URLs for data claims in citation[] field >>"] : undefined
                };
            } else if (contentType === 'person') {
                // Extract candidate name
                const candidateName = headline.replace(/^About\s+/i, '').trim() || "Emma Carter";

                // Extract party
                const hasDemocrat = prose.toLowerCase().includes('democrat');
                const hasRepublican = prose.toLowerCase().includes('republican');
                const party = hasDemocrat ? 'Democratic Party' : hasRepublican ? 'Republican Party' : '';

                // Extract office/district
                const officeMatch = prose.match(/(?:candidate for|running for)\s+([^,\n\.]+)/i) ||
                                   prose.match(/(U\.S\.\s+(?:House|Senate)[^,\n\.]*)/i) ||
                                   prose.match(/(Congress[,\s]+(?:California's |CA-?)\d+)/i);
                const office = officeMatch ? officeMatch[1].trim() : '';

                // Extract donate/volunteer URLs
                const donateMatch = prose.match(/(?:donate|contribute)[^\n]*?(?:at\s+)?(https?:\/\/[^\s<]+)/i);
                const volunteerMatch = prose.match(/(?:volunteer|get involved)[^\n]*?(?:at\s+)?(https?:\/\/[^\s<]+)/i);

                // Extract social links
                const socialLinks = ["https://emmacarterforcongress.org"];
                const twitterMatch = prose.match(/(?:twitter\.com|@)([a-zA-Z0-9_]+)/i);
                const facebookMatch = prose.match(/facebook\.com\/([a-zA-Z0-9\.]+)/i);
                const instagramMatch = prose.match(/instagram\.com\/([a-zA-Z0-9_\.]+)/i);

                if (twitterMatch) socialLinks.push(`https://twitter.com/${twitterMatch[1]}`);
                if (facebookMatch) socialLinks.push(`https://facebook.com/${facebookMatch[1]}`);
                if (instagramMatch) socialLinks.push(`https://instagram.com/${instagramMatch[1]}`);

                // Extract FEC ID
                const fecMatch = prose.match(/C00\d{6}/);

                // Build potentialAction array
                const potentialActions = [];
                if (donateMatch || prose.toLowerCase().includes('donate')) {
                    potentialActions.push({
                        "@type": "DonateAction",
                        "target": {
                            "@type": "EntryPoint",
                            "urlTemplate": donateMatch ? donateMatch[1] : "https://emmacarterforcongress.org/donate"
                        }
                    });
                }
                if (volunteerMatch || prose.toLowerCase().includes('volunteer')) {
                    potentialActions.push({
                        "@type": "JoinAction",
                        "target": {
                            "@type": "EntryPoint",
                            "urlTemplate": volunteerMatch ? volunteerMatch[1] : "https://emmacarterforcongress.org/volunteer"
                        }
                    });
                }

                return {
                    "@context": "https://schema.org",
                    "@type": "Person",
                    "@id": "https://emmacarterforcongress.org/candidate",
                    "name": candidateName,
                    "jobTitle": "Candidate for U.S. House",
                    "memberOf": party ? {
                        "@type": "Organization",
                        "name": party
                    } : { "@type": "Organization", "name": "<< MISSING: Add party affiliation >>" },
                    "identifier": fecMatch ? [{
                        "@type": "PropertyValue",
                        "propertyID": "FEC",
                        "value": fecMatch[0]
                    }] : [],
                    "sameAs": socialLinks,
                    "mainEntityOfPage": {
                        "@type": "WebPage",
                        "@id": "https://emmacarterforcongress.org/about"
                    },
                    "about": {
                        "@type": "Thing",
                        "name": office || "<< MISSING: Add office/district (e.g., U.S. House, CA-15) >>",
                        "startDate": "2026-11-03"  // General election date
                    },
                    "potentialAction": potentialActions.length > 0 ? potentialActions : undefined,
                    "publisher": {
                        "@type": "Organization",
                        "name": "Emma Carter for Congress"
                    }
                };
            } else if (contentType === 'event') {
                const addressMatch = prose.match(/(\d+\s+[A-Za-z\s]+(?:Street|Avenue|Road|Boulevard|St|Ave|Rd|Blvd)[^,]*,\s*[A-Za-z\s]+,\s*CA\s+\d{5})/i);
                const dateMatch = prose.match(/(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday),?\s+(\w+ \d+, \d{4})/i);
                const timeMatch = prose.match(/(\d{1,2}:\d{2}\s*(?:AM|PM))\s*-\s*(\d{1,2}:\d{2}\s*(?:AM|PM))/i);

                return {
                    "@context": "https://schema.org",
                    "@type": "Event",
                    "@id": "https://emmacarterforcongress.org/events/rally",
                    "name": headline,
                    "eventStatus": "https://schema.org/EventScheduled",
                    "startDate": dateMatch && timeMatch ? `${dateMatch[2]} ${timeMatch[1]}` : "<< Add in prose >>",
                    "endDate": dateMatch && timeMatch ? `${dateMatch[2]} ${timeMatch[2]}` : "<< Add in prose >>",
                    "location": {
                        "@type": "Place",
                        "name": "Jack London Square",
                        "address": addressMatch ? addressMatch[0] : "<< Add full address in prose >>"
                    },
                    "organizer": {
                        "@type": "Organization",
                        "name": "Emma Carter for Congress"
                    }
                };
            } else if (contentType === 'speech') {
                // Extract date and time for ISO 8601 format
                const dateMatch = prose.match(/(\w+)\s+(\d+),?\s+(\d{4})/);
                const timeMatch = prose.match(/(\d{1,2}):(\d{2})\s*(AM|PM|am|pm)/i);
                const locationMatch = prose.match(/at ([^,\n]+)/i) || prose.match(/in (Oakland|San Francisco|[A-Z][a-z]+(,\s*[A-Z]{2})?)/);

                // Build ISO 8601 date
                let isoDate = "<< MISSING: Add date in format YYYY-MM-DDThh:mm:ss-07:00 >>";
                if (dateMatch) {
                    const months = {jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12};
                    const monthNum = months[dateMatch[1].toLowerCase().substring(0,3)];
                    const day = dateMatch[2].padStart(2, '0');
                    const year = dateMatch[3];

                    if (monthNum && timeMatch) {
                        const hour24 = timeMatch[3].toLowerCase() === 'pm' && timeMatch[1] !== '12'
                            ? parseInt(timeMatch[1]) + 12
                            : timeMatch[1].padStart(2, '0');
                        const min = timeMatch[2];
                        isoDate = `${year}-${monthNum.toString().padStart(2,'0')}-${day}T${hour24}:${min}:00-07:00`;
                    } else if (monthNum) {
                        isoDate = `${year}-${monthNum.toString().padStart(2,'0')}-${day}`;
                    }
                }

                // Extract topics for about[] field
                const topicMatches = prose.match(/(jobs|housing|climate|healthcare|education|infrastructure|economy)/gi) || [];
                const uniqueTopics = [...new Set(topicMatches.map(t => t.toLowerCase()))];

                return {
                    "@context": "https://schema.org",
                    "@type": "Speech",
                    "@id": "https://emmacarterforcongress.org/speeches/labor-day-rally",
                    "name": headline.substring(0, 110),
                    "author": {
                        "@type": "Person",
                        "name": "Emma Carter"
                    },
                    "datePublished": isoDate,
                    "temporalCoverage": dateMatch ? `${dateMatch[3]}-${months[dateMatch[1].toLowerCase().substring(0,3)]?.toString().padStart(2,'0') || '01'}-${dateMatch[2].padStart(2,'0')}` : undefined,
                    "location": locationMatch ? {
                        "@type": "Place",
                        "name": locationMatch[1]
                    } : { "@type": "Place", "name": "<< MISSING: Add venue or city >>" },
                    "text": "Full transcript is available on this page.",
                    "about": uniqueTopics.length > 0 ? uniqueTopics.slice(0, 3).map(topic => ({
                        "@type": "DefinedTerm",
                        "termCode": topic
                    })) : undefined,
                    "keywords": uniqueTopics,
                    "citation": ["<< MISSING: Add source URLs for factual claims >>"],
                    "isBasedOn": [],
                    "mainEntityOfPage": {
                        "@type": "WebPage",
                        "@id": "https://emmacarterforcongress.org/speeches/labor-day-rally"
                    },
                    "publisher": {
                        "@type": "Organization",
                        "name": "Emma Carter for Congress"
                    }
                };
            } else if (contentType === 'issues') {
                return {
                    "@context": "https://schema.org",
                    "@type": "WebPage",
                    "@id": "https://emmacarterforcongress.org/issues",
                    "name": "Issues",
                    "about": {
                        "@type": "Person",
                        "name": "Emma Carter"
                    }
                };
            } else if (contentType === 'qapage') {
                // Extract question and answer from prose
                const paragraphs = prose.split('\n').filter(p => p.trim());
                let questionText = headline;
                let answerText = '';

                // Look for "Question:" and "Answer:" patterns
                for (let i = 0; i < paragraphs.length; i++) {
                    const para = paragraphs[i];
                    if (para.match(/Question:/i)) {
                        questionText = para.replace(/^<strong>|<\/strong>$/g, '').replace(/Question:\s*/i, '').trim();
                    } else if (para.match(/Answer:|Emma's Answer:/i)) {
                        // Get answer text (may span multiple paragraphs until next heading)
                        answerText = para.replace(/^<strong>|<\/strong>$/g, '').replace(/(Answer:|Emma's Answer:)\s*/i, '').trim();

                        // Collect subsequent paragraphs as part of answer
                        for (let j = i + 1; j < paragraphs.length && !paragraphs[j].match(/^<h[12]>|Question:/i); j++) {
                            answerText += ' ' + paragraphs[j].replace(/<[^>]+>/g, '').trim();
                        }
                        break;
                    }
                }

                // Extract policy topics for about[] field
                const policyTopics = prose.match(/(reproductive rights|healthcare|climate|housing|education|jobs|economy)/gi) || [];
                const uniqueTopics = [...new Set(policyTopics.map(t => t.toLowerCase().replace(/\s+/g, '-')))];

                return {
                    "@context": "https://schema.org",
                    "@type": "QAPage",
                    "@id": "https://emmacarterforcongress.org/qa/reproductive-rights",
                    "mainEntity": {
                        "@type": "Question",
                        "name": questionText,
                        "author": { "@type": "Person", "name": "Emma Carter" },
                        "acceptedAnswer": {
                            "@type": "Answer",
                            "text": answerText || "<< MISSING: Add policy answer (100+ words recommended) >>",
                            "author": { "@type": "Person", "name": "Emma Carter" }
                        }
                    },
                    "about": uniqueTopics.length > 0 ? uniqueTopics.map(topic => ({
                        "@type": "DefinedTerm",
                        "termCode": topic
                    })) : undefined,
                    "mainEntityOfPage": {
                        "@type": "WebPage",
                        "@id": "https://emmacarterforcongress.org/qa/reproductive-rights"
                    },
                    "publisher": {
                        "@type": "Organization",
                        "name": "Emma Carter for Congress"
                    }
                };
            } else if (contentType === 'faqpage') {
                // Extract all Q&A pairs from prose
                const questions = [];
                const paragraphs = prose.split('\n').filter(p => p.trim());

                for (let i = 0; i < paragraphs.length; i++) {
                    const para = paragraphs[i];

                    // Check for bold questions (using <strong> tags in contenteditable)
                    if (para.match(/^<strong>/) && para.includes('?')) {
                        const questionText = para.replace(/<\/?strong>/g, '').trim();
                        const nextPara = paragraphs[i + 1] || '';
                        const answerText = nextPara.replace(/<[^>]+>/g, '').trim();

                        questions.push({
                            "@type": "Question",
                            "name": questionText,
                            "acceptedAnswer": {
                                "@type": "Answer",
                                "text": answerText || "<< MISSING: Add answer >>"
                            }
                        });
                    }
                }

                // If no questions found, provide template
                if (questions.length === 0) {
                    questions.push({
                        "@type": "Question",
                        "name": "<< MISSING: Add question text >>",
                        "acceptedAnswer": {
                            "@type": "Answer",
                            "text": "<< MISSING: Add answer >>"
                        }
                    });
                }

                return {
                    "@context": "https://schema.org",
                    "@type": "FAQPage",
                    "@id": "https://emmacarterforcongress.org/faq",
                    "mainEntity": questions,
                    "about": {
                        "@type": "Person",
                        "name": "Emma Carter"
                    },
                    "mainEntityOfPage": {
                        "@type": "WebPage",
                        "@id": "https://emmacarterforcongress.org/faq"
                    },
                    "publisher": {
                        "@type": "Organization",
                        "name": "Emma Carter for Congress"
                    }
                };
            }

            return { "@context": "https://schema.org", "@type": contentType };
        }

        function displayJSONLD(jsonld) {
            const preview = document.getElementById('jsonld-preview');
            const formatted = JSON.stringify(jsonld, null, 2);

            // Enhanced syntax highlighting
            let highlighted = formatted
                // Highlight MISSING values first
                .replace(/"<<\s*MISSING[^"]*>>"/g, '<span class="json-empty">$&</span>')
                // Keys (@context, @type, etc.)
                .replace(/"(@[^"]+)"(\s*):/g, '<span class="json-key">"$1"</span><span class="json-colon">$2:</span>')
                // Regular keys
                .replace(/"([^"]+)"(\s*):/g, '<span class="json-key">"$1"</span><span class="json-colon">$2:</span>')
                // String values (but not keys or missing markers)
                .replace(/:\s*"([^"]*(?:"[^"]*")*)"/g, (match, p1) => {
                    if (match.includes('json-') || match.includes('MISSING')) return match;
                    return `: <span class="json-string">"${p1}"</span>`;
                })
                // Brackets
                .replace(/\[/g, '<span class="json-bracket">[</span>')
                .replace(/\]/g, '<span class="json-bracket">]</span>')
                .replace(/\{/g, '<span class="json-bracket">{</span>')
                .replace(/\}/g, '<span class="json-bracket">}</span>')
                // Commas
                .replace(/,$/gm, '<span class="json-comma">,</span>');

            preview.innerHTML = `<code>${highlighted}</code>`;
        }

        function calculateScore(recs) {
            const criticalErrors = recs.errors.length;
            const minorIssues = recs.warnings.length;
            const totalIssues = criticalErrors + minorIssues;

            if (totalIssues === 0) return 100;

            // Weight errors more heavily than warnings
            const errorPenalty = criticalErrors * 12;
            const warningPenalty = minorIssues * 5;
            const totalPenalty = errorPenalty + warningPenalty;

            return Math.max(20, 100 - totalPenalty);
        }

        function displayScore(score, recs) {
            const scoreEl = document.getElementById('completeness-score');
            scoreEl.textContent = score + '%';

            if (score >= 80) scoreEl.style.color = '#10b981';
            else if (score >= 50) scoreEl.style.color = '#f59e0b';
            else scoreEl.style.color = '#ef4444';

            document.getElementById('error-count').textContent = recs.errors.length;
            document.getElementById('warning-count').textContent = recs.warnings.length;
            document.getElementById('ok-count').textContent = '‚úì';
        }

        function highlightRecommendation(field, index) {
            const rec = window.currentRecommendations[index];

            // Clear previous highlights
            document.querySelectorAll('.prose-highlight').forEach(el => {
                el.classList.remove('prose-highlight');
            });
            document.querySelectorAll('.json-highlight').forEach(el => {
                el.classList.remove('json-highlight');
            });

            // Expand JSON-LD preview if collapsed
            const jsonContainer = document.getElementById('jsonld-container');
            if (!jsonContainer.classList.contains('expanded')) {
                jsonContainer.classList.add('expanded');
            }

            // Highlight in JSON-LD
            setTimeout(() => {
                const jsonPreview = document.getElementById('jsonld-preview');
                const jsonHTML = jsonPreview.innerHTML;

                // Find the field in JSON
                const fieldPattern = new RegExp(`"${field}"\\s*:\\s*[^,}]+`, 'g');
                const highlightedJSON = jsonHTML.replace(fieldPattern, (match) => {
                    return `<span class="json-highlight">${match}</span>`;
                });

                jsonPreview.innerHTML = highlightedJSON;

                // Scroll JSON preview to highlighted field
                const highlighted = jsonPreview.querySelector('.json-highlight');
                if (highlighted) {
                    highlighted.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 100);

            // Highlight in prose based on recommendation type
            const proseEditor = document.getElementById('prose-editor');
            const proseText = proseEditor.innerText;

            let searchTerms = [];

            // Determine what to highlight based on field
            if (field === 'datePublished') {
                searchTerms = [proseText.match(/Oakland, CA ‚Äî [^<\n]+/)?.[0]];
            } else if (field === 'claims.evidence') {
                searchTerms = [proseText.match(/\d+%[^\."]*/)?.[0]];
            } else if (field.includes('contact')) {
                searchTerms = ['###'];
            } else if (field.includes('mentions')) {
                searchTerms = [proseText.match(/[Hh]er opponent[^\."]*/)?.[0]];
            } else if (field.includes('party') || field === 'memberOf.name') {
                searchTerms = [proseText.match(/Emma Carter is[^\."]*/)?.[0]];
            } else if (rec.searchText) {
                searchTerms = [rec.searchText];
            }

            // Highlight text in prose
            searchTerms = searchTerms.filter(t => t);
            if (searchTerms.length > 0) {
                searchTerms.forEach(term => {
                    if (term && term.trim()) {
                        const innerHTML = proseEditor.innerHTML;
                        const escapedTerm = term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                        const regex = new RegExp(`(${escapedTerm})`, 'gi');

                        // Only highlight if not already in a tag
                        const highlighted = innerHTML.replace(regex, (match) => {
                            return `<mark class="prose-highlight">${match}</mark>`;
                        });

                        proseEditor.innerHTML = highlighted;

                        // Scroll to highlighted text
                        const highlightedEl = proseEditor.querySelector('.prose-highlight');
                        if (highlightedEl) {
                            highlightedEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }
                });
            }
        }
    </script>
</body>
</html>
