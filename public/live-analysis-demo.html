<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Analysis Demo - Campaign AI Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #1e293b;
            line-height: 1.6;
        }

        .header {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 16px 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
            color: #0f172a;
        }

        .header p {
            font-size: 14px;
            color: #64748b;
            margin-top: 4px;
        }

        .container {
            display: flex;
            height: calc(100vh - 80px);
            gap: 1px;
            background: #e2e8f0;
        }

        .editor-panel {
            flex: 0 0 60%;
            background: white;
            overflow-y: auto;
            padding: 24px;
        }

        .suggestions-panel {
            flex: 0 0 40%;
            background: #fafafa;
            overflow-y: auto;
            padding: 24px;
            border-left: 1px solid #e2e8f0;
        }

        .field-group {
            margin-bottom: 24px;
        }

        .field-label {
            font-size: 14px;
            font-weight: 600;
            color: #475569;
            margin-bottom: 8px;
            display: block;
        }

        .field-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 15px;
            font-family: inherit;
            transition: border-color 0.2s;
            background: white;
        }

        .field-input:focus {
            outline: none;
            border-color: #3b82f6;
            background: #fefefe;
        }

        .field-input.has-errors {
            border-color: #ef4444;
            background: #fef2f2;
        }

        .field-input.has-warnings {
            border-color: #f59e0b;
            background: #fffbeb;
        }

        textarea.field-input {
            min-height: 120px;
            resize: vertical;
        }

        .analysis-indicator {
            display: none;
            font-size: 13px;
            color: #64748b;
            margin-top: 4px;
            font-style: italic;
        }

        .analysis-indicator.active {
            display: block;
        }

        .suggestions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .suggestions-title {
            font-size: 18px;
            font-weight: 600;
            color: #0f172a;
        }

        .suggestions-count {
            display: inline-block;
            background: #3b82f6;
            color: white;
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
        }

        .suggestions-count.empty {
            background: #10b981;
        }

        .suggestion-group {
            margin-bottom: 24px;
        }

        .group-header {
            font-size: 14px;
            font-weight: 600;
            color: #475569;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .suggestion-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .suggestion-card.error {
            border-left: 4px solid #ef4444;
        }

        .suggestion-card.warning {
            border-left: 4px solid #f59e0b;
        }

        .suggestion-card.suggestion {
            border-left: 4px solid #3b82f6;
        }

        .suggestion-field {
            font-size: 12px;
            color: #64748b;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .suggestion-change {
            font-size: 14px;
            margin-bottom: 8px;
        }

        .suggestion-before {
            color: #ef4444;
            text-decoration: line-through;
        }

        .suggestion-after {
            color: #10b981;
            font-weight: 500;
        }

        .suggestion-reason {
            font-size: 13px;
            color: #475569;
            margin-bottom: 12px;
            padding: 8px;
            background: #f8fafc;
            border-radius: 4px;
        }

        .suggestion-actions {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-accept {
            background: #10b981;
            color: white;
        }

        .btn-accept:hover {
            background: #059669;
        }

        .btn-reject {
            background: #e2e8f0;
            color: #475569;
        }

        .btn-reject:hover {
            background: #cbd5e1;
        }

        .notification {
            position: fixed;
            top: 80px;
            right: 24px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            min-width: 300px;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.warning {
            border-left: 4px solid #f59e0b;
        }

        .notification.success {
            border-left: 4px solid #10b981;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .empty-state {
            text-align: center;
            padding: 48px 24px;
            color: #64748b;
        }

        .empty-state h3 {
            font-size: 16px;
            margin-bottom: 8px;
        }

        .empty-state p {
            font-size: 14px;
        }

        .settings-bar {
            background: #f1f5f9;
            padding: 12px 24px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            gap: 24px;
            align-items: center;
            font-size: 14px;
        }

        .setting-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .setting-item label {
            color: #475569;
            font-weight: 500;
        }

        .setting-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .setting-item select {
            padding: 4px 8px;
            border: 1px solid #cbd5e1;
            border-radius: 4px;
            font-size: 13px;
        }

        .view-mode-toggle {
            display: flex;
            gap: 0;
            background: white;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            overflow: hidden;
        }

        .view-mode-btn {
            padding: 6px 16px;
            border: none;
            background: transparent;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            color: #64748b;
            transition: all 0.2s;
        }

        .view-mode-btn.active {
            background: #3b82f6;
            color: white;
        }

        .view-mode-btn:hover:not(.active) {
            background: #f1f5f9;
        }

        .full-text-editor {
            display: none;
        }

        .full-text-editor.active {
            display: block;
        }

        .full-text-area {
            width: 100%;
            min-height: 400px;
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 15px;
            font-family: inherit;
            line-height: 1.8;
            resize: vertical;
        }

        .full-text-area:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .full-text-info {
            margin-top: 12px;
            padding: 12px;
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 6px;
            font-size: 13px;
            color: #1e40af;
        }

        .tabs-container {
            display: flex;
            gap: 4px;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 16px;
        }

        .tab-button {
            padding: 10px 20px;
            border: none;
            background: transparent;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            color: #64748b;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
        }

        .tab-button:hover {
            color: #3b82f6;
        }

        .tab-button.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }

        .tab-badge {
            display: inline-block;
            background: #e2e8f0;
            color: #475569;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 6px;
            font-weight: 600;
        }

        .tab-button.active .tab-badge {
            background: #3b82f6;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .undo-redo-bar {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e2e8f0;
        }

        .btn-undo,
        .btn-redo {
            padding: 8px 16px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            background: white;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-undo:hover:not(:disabled),
        .btn-redo:hover:not(:disabled) {
            background: #f1f5f9;
            border-color: #94a3b8;
        }

        .btn-undo:disabled,
        .btn-redo:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .applied-item {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .applied-item.accepted {
            border-left: 3px solid #10b981;
        }

        .applied-item.rejected {
            border-left: 3px solid #64748b;
        }

        .applied-change {
            margin-bottom: 4px;
        }

        .applied-meta {
            font-size: 11px;
            color: #64748b;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>📝 Live Analysis Demo</h1>
        <p>Type freely in any field - content is automatically re-analyzed to catch new issues</p>
    </div>

    <div class="settings-bar">
        <div class="setting-item">
            <label style="margin-right: 8px; font-weight: 600;">View Mode:</label>
            <div class="view-mode-toggle">
                <button class="view-mode-btn active" data-mode="fields">📝 By Field</button>
                <button class="view-mode-btn" data-mode="full-text">📄 Full Text</button>
            </div>
        </div>
        <div class="setting-item">
            <input type="checkbox" id="setting-realtime" checked>
            <label for="setting-realtime">Real-time Analysis</label>
        </div>
        <div class="setting-item">
            <label for="setting-debounce">Debounce (ms):</label>
            <select id="setting-debounce">
                <option value="200">200</option>
                <option value="500" selected>500</option>
                <option value="1000">1000</option>
                <option value="2000">2000</option>
            </select>
        </div>
        <div class="setting-item">
            <label for="setting-confidence">Min Confidence:</label>
            <select id="setting-confidence">
                <option value="0.3">0.3</option>
                <option value="0.5" selected>0.5</option>
                <option value="0.7">0.7</option>
                <option value="0.9">0.9</option>
            </select>
        </div>
    </div>

    <div class="container">
        <div class="editor-panel">
            <!-- By Field View -->
            <div id="fields-view" class="fields-view">
                <h2 style="font-size: 16px; font-weight: 600; margin-bottom: 20px; color: #475569;">
                    Press Release Fields
                </h2>

                <div class="field-group">
                <label class="field-label" for="headline">Headline</label>
                <input type="text"
                       id="headline"
                       class="field-input"
                       data-editable-field="headline"
                       placeholder="Enter headline...">
                <div class="analysis-indicator" id="indicator-headline">Analyzing...</div>
            </div>

            <div class="field-group">
                <label class="field-label" for="dateline">Dateline</label>
                <input type="text"
                       id="dateline"
                       class="field-input"
                       data-editable-field="dateline"
                       placeholder="e.g., BOSTON, MA - Jan. 15, 2025">
                <div class="analysis-indicator" id="indicator-dateline">Analyzing...</div>
            </div>

            <div class="field-group">
                <label class="field-label" for="lead_paragraph">Lead Paragraph</label>
                <textarea id="lead_paragraph"
                          class="field-input"
                          data-editable-field="lead_paragraph"
                          placeholder="Enter lead paragraph..."></textarea>
                <div class="analysis-indicator" id="indicator-lead_paragraph">Analyzing...</div>
            </div>

            <div class="field-group">
                <label class="field-label" for="body_text">Body Text</label>
                <textarea id="body_text"
                          class="field-input"
                          data-editable-field="body_text"
                          placeholder="Enter body text..."></textarea>
                <div class="analysis-indicator" id="indicator-body_text">Analyzing...</div>
            </div>

            <div class="field-group">
                <label class="field-label" for="quote_1">Quote 1</label>
                <textarea id="quote_1"
                          class="field-input"
                          data-editable-field="quote_1"
                          placeholder="Enter first quote..."></textarea>
                <div class="analysis-indicator" id="indicator-quote_1">Analyzing...</div>
            </div>
            </div>

            <!-- Full Text View -->
            <div id="full-text-view" class="full-text-editor">
                <h2 style="font-size: 16px; font-weight: 600; margin-bottom: 12px; color: #475569;">
                    Full Text Editor
                </h2>
                <div class="full-text-info">
                    💡 <strong>Tip:</strong> Edit the full text here and changes will automatically sync to individual fields.
                    Use standard separators: "---" for sections, empty lines between paragraphs.
                </div>
                <textarea id="full-text-area"
                          class="full-text-area"
                          placeholder="Paste or type your full press release here...

Example format:

Headline: Your headline here

Dateline: CITY, STATE - Month Day, Year

Lead Paragraph: First paragraph of your press release...

Body Text: Additional paragraphs...

Quote: &quot;Your quote here&quot;

---

The text will be automatically parsed into fields and analyzed for issues."></textarea>
            </div>
        </div>

        <div class="suggestions-panel">
            <div class="suggestions-header">
                <h2 class="suggestions-title">Analysis</h2>
            </div>

            <div class="undo-redo-bar">
                <button class="btn-undo" id="btn-undo" disabled>
                    ↶ Undo
                </button>
                <button class="btn-redo" id="btn-redo" disabled>
                    ↷ Redo
                </button>
            </div>

            <!-- Tabs -->
            <div class="tabs-container">
                <button class="tab-button active" data-tab="suggestions">
                    Suggestions
                    <span class="tab-badge" id="suggestions-count">0</span>
                </button>
                <button class="tab-button" data-tab="applied">
                    Applied
                    <span class="tab-badge" id="applied-count">0</span>
                </button>
                <button class="tab-button" data-tab="rejected">
                    Rejected
                    <span class="tab-badge" id="rejected-count">0</span>
                </button>
            </div>

            <!-- Suggestions Tab -->
            <div id="suggestions-tab" class="tab-content active">
                <div id="suggestions-container">
                    <div class="empty-state">
                        <h3>✅ No suggestions yet</h3>
                        <p>Start typing in the fields to get real-time feedback</p>
                    </div>
                </div>
            </div>

            <!-- Applied Tab -->
            <div id="applied-tab" class="tab-content">
                <div id="applied-content">
                    <div class="empty-state">
                        <p>No applied suggestions yet</p>
                    </div>
                </div>
            </div>

            <!-- Rejected Tab -->
            <div id="rejected-tab" class="tab-content">
                <div id="rejected-content">
                    <div class="empty-state">
                        <p>No rejected suggestions yet</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { LiveAnalysisEngine } from './js/live-analysis-engine.js';
        import { SuggestionSorter } from './js/suggestion-sorter.js';

        // Initialize settings
        let settings = {
            real_time_suggestions: true,
            debounce_delay: 500,
            min_confidence_to_show: 0.5,
            suggestions_sort_order: 'severity',
            group_suggestions_by: 'category'
        };

        // Initialize engines
        const liveAnalysis = new LiveAnalysisEngine(settings);
        const sorter = new SuggestionSorter(settings);

        // Register all editable fields
        document.querySelectorAll('[data-editable-field]').forEach(field => {
            const fieldName = field.dataset.editableField;
            liveAnalysis.registerField(field, fieldName);
        });

        // Listen for analysis events
        liveAnalysis.on('analysis-started', ({ field }) => {
            const indicator = document.getElementById(`indicator-${field}`);
            if (indicator) {
                indicator.classList.add('active');
            }
        });

        liveAnalysis.on('analysis-complete', ({ field, suggestions }) => {
            const indicator = document.getElementById(`indicator-${field}`);
            if (indicator) {
                indicator.classList.remove('active');
            }

            // Update field styling
            const fieldElement = document.querySelector(`[data-editable-field="${field}"]`);
            if (fieldElement) {
                fieldElement.classList.remove('has-errors', 'has-warnings');

                const errors = suggestions.filter(s => s.severity === 'error');
                const warnings = suggestions.filter(s => s.severity === 'warning');

                if (errors.length > 0) {
                    fieldElement.classList.add('has-errors');
                } else if (warnings.length > 0) {
                    fieldElement.classList.add('has-warnings');
                }
            }

            // Update suggestions panel
            updateSuggestionsPanel();
        });

        liveAnalysis.on('new-errors-detected', ({ field, errors, message }) => {
            showNotification(message, 'warning');
        });

        liveAnalysis.on('suggestion-applied', ({ field, suggestion }) => {
            showNotification(`✅ Applied: ${suggestion.after}`, 'success');
            updateSuggestionsPanel();
            updateAppliedPanel();
            updateUndoRedoButtons();
        });

        liveAnalysis.on('suggestion-rejected', ({ field, suggestion }) => {
            showNotification('Suggestion rejected', 'success');
            updateSuggestionsPanel();
            updateAppliedPanel();
            updateUndoRedoButtons();
        });

        liveAnalysis.on('action-undone', ({ action }) => {
            showNotification('Action undone', 'success');
            updateSuggestionsPanel();
            updateAppliedPanel();
            updateUndoRedoButtons();
        });

        liveAnalysis.on('action-redone', ({ action }) => {
            showNotification('Action redone', 'success');
            updateSuggestionsPanel();
            updateAppliedPanel();
            updateUndoRedoButtons();
        });

        // Update suggestions panel
        function updateSuggestionsPanel() {
            const allSuggestions = liveAnalysis.getAllSuggestions();
            const container = document.getElementById('suggestions-container');
            const countElement = document.getElementById('suggestions-count');

            // Update count
            countElement.textContent = allSuggestions.length;
            countElement.classList.toggle('empty', allSuggestions.length === 0);

            if (allSuggestions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>✅ No suggestions</h3>
                        <p>All fields look good!</p>
                    </div>
                `;
                return;
            }

            // Sort and group suggestions
            const grouped = sorter.processSuggestions(allSuggestions);

            // Render grouped suggestions
            container.innerHTML = Object.entries(grouped)
                .map(([groupName, suggestions]) => `
                    <div class="suggestion-group">
                        <div class="group-header">
                            <span>${groupName}</span>
                            <span style="font-size: 12px; font-weight: 500; color: #64748b;">
                                ${suggestions.length} ${suggestions.length === 1 ? 'item' : 'items'}
                            </span>
                        </div>
                        ${suggestions.map(s => renderSuggestionCard(s)).join('')}
                    </div>
                `).join('');
        }

        function renderSuggestionCard(suggestion) {
            const severityEmoji = {
                'error': '❌',
                'warning': '⚠️',
                'suggestion': '💡'
            };

            return `
                <div class="suggestion-card ${suggestion.severity}" data-suggestion-id="${suggestion.id}">
                    <div class="suggestion-field">
                        ${severityEmoji[suggestion.severity]} In "${formatFieldName(suggestion.field)}" field
                    </div>
                    <div class="suggestion-change">
                        <span class="suggestion-before">"${suggestion.before}"</span>
                        →
                        <span class="suggestion-after">"${suggestion.after}"</span>
                    </div>
                    <div class="suggestion-reason">
                        ${suggestion.reason}
                    </div>
                    <div class="suggestion-actions">
                        <button class="btn btn-accept" onclick="acceptSuggestion('${suggestion.id}')">
                            Accept
                        </button>
                        <button class="btn btn-reject" onclick="rejectSuggestion('${suggestion.id}')">
                            Reject
                        </button>
                    </div>
                </div>
            `;
        }

        function formatFieldName(field) {
            return field.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        // Accept suggestion
        window.acceptSuggestion = function(suggestionId) {
            const allSuggestions = liveAnalysis.getAllSuggestions();
            const suggestion = allSuggestions.find(s => s.id === suggestionId);

            if (!suggestion) return;

            const fieldElement = document.querySelector(`[data-editable-field="${suggestion.field}"]`);
            liveAnalysis.applySuggestion(suggestion.field, suggestionId, fieldElement);
        };

        // Reject suggestion
        window.rejectSuggestion = function(suggestionId) {
            const allSuggestions = liveAnalysis.getAllSuggestions();
            const suggestion = allSuggestions.find(s => s.id === suggestionId);

            if (!suggestion) return;

            liveAnalysis.rejectSuggestion(suggestion.field, suggestionId);
        };

        // Update applied and rejected panels
        function updateAppliedPanel() {
            const appliedSuggestions = liveAnalysis.getAppliedSuggestions();

            // Separate applied and rejected
            const applied = appliedSuggestions.filter(s => s.status !== 'rejected');
            const rejected = appliedSuggestions.filter(s => s.status === 'rejected');

            // Update counts
            document.getElementById('applied-count').textContent = applied.length;
            document.getElementById('rejected-count').textContent = rejected.length;

            // Update applied tab
            const appliedContainer = document.getElementById('applied-content');
            if (applied.length === 0) {
                appliedContainer.innerHTML = `
                    <div class="empty-state">
                        <p>No applied suggestions yet</p>
                    </div>
                `;
            } else {
                appliedContainer.innerHTML = applied.map(s => {
                    const timestamp = s.appliedAt;
                    const timeAgo = timestamp ? formatTimeAgo(new Date(timestamp)) : '';

                    return `
                        <div class="applied-item accepted">
                            <div class="applied-change">
                                ✅ <strong>${formatFieldName(s.field)}</strong>:
                                "${s.before}" → "${s.after}"
                            </div>
                            <div class="applied-meta">
                                Applied ${timeAgo}
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // Update rejected tab
            const rejectedContainer = document.getElementById('rejected-content');
            if (rejected.length === 0) {
                rejectedContainer.innerHTML = `
                    <div class="empty-state">
                        <p>No rejected suggestions yet</p>
                    </div>
                `;
            } else {
                rejectedContainer.innerHTML = rejected.map(s => {
                    const timestamp = s.rejectedAt;
                    const timeAgo = timestamp ? formatTimeAgo(new Date(timestamp)) : '';

                    return `
                        <div class="applied-item rejected">
                            <div class="applied-change">
                                🚫 <strong>${formatFieldName(s.field)}</strong>:
                                <span style="color: #64748b;">Rejected "${s.before}"</span>
                            </div>
                            <div class="applied-meta">
                                Rejected ${timeAgo}
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        // Update undo/redo buttons
        function updateUndoRedoButtons() {
            const undoBtn = document.getElementById('btn-undo');
            const redoBtn = document.getElementById('btn-redo');

            undoBtn.disabled = !liveAnalysis.canUndo();
            redoBtn.disabled = !liveAnalysis.canRedo();
        }

        // Format time ago
        function formatTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);

            if (seconds < 5) return 'just now';
            if (seconds < 60) return `${seconds}s ago`;

            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes}m ago`;

            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours}h ago`;

            return `${Math.floor(hours / 24)}d ago`;
        }

        // Undo/Redo button handlers
        document.getElementById('btn-undo').addEventListener('click', () => {
            liveAnalysis.undo();
        });

        document.getElementById('btn-redo').addEventListener('click', () => {
            liveAnalysis.redo();
        });

        // Keyboard shortcuts for undo/redo
        document.addEventListener('keydown', (e) => {
            // Cmd/Ctrl + Z for undo
            if ((e.metaKey || e.ctrlKey) && e.key === 'z' && !e.shiftKey) {
                e.preventDefault();
                liveAnalysis.undo();
            }
            // Cmd/Ctrl + Shift + Z for redo
            else if ((e.metaKey || e.ctrlKey) && e.key === 'z' && e.shiftKey) {
                e.preventDefault();
                liveAnalysis.redo();
            }
            // Cmd/Ctrl + Y for redo (alternative)
            else if ((e.metaKey || e.ctrlKey) && e.key === 'y') {
                e.preventDefault();
                liveAnalysis.redo();
            }
        });

        // Tab switching
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                const tabName = button.dataset.tab;

                // Update active tab button
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                // Update active tab content
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                document.getElementById(`${tabName}-tab`).classList.add('active');
            });
        });

        // View mode toggle
        document.querySelectorAll('.view-mode-btn').forEach(button => {
            button.addEventListener('click', () => {
                const mode = button.dataset.mode;

                // Update active button
                document.querySelectorAll('.view-mode-btn').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                // Switch views
                if (mode === 'fields') {
                    document.getElementById('fields-view').style.display = 'block';
                    document.getElementById('full-text-view').classList.remove('active');
                    syncFieldsToFullText(); // Update full text from fields
                } else {
                    document.getElementById('fields-view').style.display = 'none';
                    document.getElementById('full-text-view').classList.add('active');
                    syncFieldsToFullText(); // Populate full text
                }
            });
        });

        // Sync fields to full text view
        function syncFieldsToFullText() {
            const headline = document.getElementById('headline').value;
            const dateline = document.getElementById('dateline').value;
            const lead = document.getElementById('lead_paragraph').value;
            const body = document.getElementById('body_text').value;
            const quote = document.getElementById('quote_1').value;

            let fullText = '';
            if (headline) fullText += `${headline}\n\n`;
            if (dateline) fullText += `${dateline}\n\n`;
            if (lead) fullText += `${lead}\n\n`;
            if (body) fullText += `${body}\n\n`;
            if (quote) fullText += `"${quote}"\n\n`;

            document.getElementById('full-text-area').value = fullText.trim();
        }

        // Parse full text and update fields
        function parseFullTextToFields(text) {
            const lines = text.split('\n').map(l => l.trim()).filter(l => l);

            if (lines.length === 0) return;

            // Simple parsing logic
            let currentField = 'headline';
            let fieldMap = {
                headline: '',
                dateline: '',
                lead_paragraph: '',
                body_text: '',
                quote_1: ''
            };

            lines.forEach((line, idx) => {
                if (idx === 0) {
                    // First line is headline
                    fieldMap.headline = line;
                } else if (line.match(/^[A-Z\s]+,\s+[A-Z]{2}\s+-/)) {
                    // Dateline pattern: "CITY, STATE -"
                    fieldMap.dateline = line;
                } else if (line.startsWith('"') && line.endsWith('"')) {
                    // Quote
                    fieldMap.quote_1 = line.replace(/^"|"$/g, '');
                } else if (idx === 1 || (idx === 2 && fieldMap.dateline)) {
                    // Lead paragraph (second line or third if dateline exists)
                    fieldMap.lead_paragraph += (fieldMap.lead_paragraph ? ' ' : '') + line;
                } else {
                    // Body text
                    fieldMap.body_text += (fieldMap.body_text ? '\n\n' : '') + line;
                }
            });

            // Update field values
            Object.entries(fieldMap).forEach(([field, value]) => {
                const element = document.querySelector(`[data-editable-field="${field}"]`);
                if (element && value) {
                    element.value = value;
                    liveAnalysis.fieldValues.set(field, value);
                }
            });
        }

        // Listen for full text changes
        const fullTextArea = document.getElementById('full-text-area');
        let fullTextDebounce;
        fullTextArea.addEventListener('input', () => {
            clearTimeout(fullTextDebounce);
            fullTextDebounce = setTimeout(() => {
                parseFullTextToFields(fullTextArea.value);
                // Re-analyze all fields
                liveAnalysis.analyzeAllFields();
            }, 1000);
        });

        // Show notification
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }

        // Settings controls
        document.getElementById('setting-realtime').addEventListener('change', (e) => {
            settings.real_time_suggestions = e.target.checked;
            liveAnalysis.updateSettings(settings);
        });

        document.getElementById('setting-debounce').addEventListener('change', (e) => {
            settings.debounce_delay = parseInt(e.target.value);
            liveAnalysis.updateSettings(settings);
        });

        document.getElementById('setting-confidence').addEventListener('change', (e) => {
            settings.min_confidence_to_show = parseFloat(e.target.value);
            liveAnalysis.updateSettings(settings);
            sorter.updateSettings(settings);
            updateSuggestionsPanel();
        });

        console.log('✅ Live Analysis Demo initialized');
    </script>
</body>
</html>
