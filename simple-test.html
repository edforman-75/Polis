<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campaign Content Editor - Working Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        textarea { width: 100%; height: 200px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 10px 20px; margin: 10px 5px; background: #007cba; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #005a87; }
        .result { margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .loading { color: #007cba; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Campaign Content Editor - Working Test</h1>
        <p>This is a simple working version with the paste text functionality.</p>

        <div>
            <label for="paste-input">Text Input:</label>
            <textarea id="paste-input" placeholder="Paste your campaign content here...">U.S. Congresswoman Abigail Spanberger (VA-07) is serving her third term in the U.S. House of Representatives. In Congress, she serves on the U.S. House Permanent Select Committee on Intelligence and the U.S. House Agriculture Committee ‚Äî and she has risen to become one of the most bipartisan lawmakers in the country.

Before Congress, Spanberger served as a federal law enforcement officer ‚Äî tracking narcotics traffickers and working money laundering cases ‚Äî and as a CIA case officer ‚Äî working undercover on counterterrorism and nuclear counterproliferation cases. She and her husband Adam are the proud parents of three school-aged daughters.</textarea>
        </div>

        <div>
            <button onclick="testToneAnalysis()">üé≠ Test Tone Analysis</button>
            <button onclick="testGrammarAnalysis()">üìù Test Grammar Analysis</button>
            <button onclick="clearText()">Clear</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        // Fixed getCurrentText function - now uses correct element ID
        function getCurrentText() {
            return document.getElementById('paste-input').value;
        }

        async function testToneAnalysis() {
            const resultsDiv = document.getElementById('results');
            const text = getCurrentText();

            if (!text.trim()) {
                resultsDiv.innerHTML = '<div class="result error">Please enter some text first.</div>';
                return;
            }

            resultsDiv.innerHTML = '<div class="result loading">Analyzing tone...</div>';

            try {
                const response = await fetch('/api/analyze/tone', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text })
                });

                const data = await response.json();

                if (data.success) {
                    resultsDiv.innerHTML = `
                        <div class="result success">
                            <h3>‚úÖ Tone Analysis Successful!</h3>
                            <p><strong>Text analyzed:</strong> ${text.length} characters</p>
                            <p><strong>Status:</strong> The tone analysis API is working correctly.</p>
                            <details>
                                <summary>View full results</summary>
                                <pre>${JSON.stringify(data.analysis, null, 2)}</pre>
                            </details>
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = `
                        <div class="result error">
                            <h3>‚ùå Tone Analysis Failed</h3>
                            <p><strong>Error:</strong> ${data.error}</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå Connection Error</h3>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p>Make sure the server is running on localhost:3002</p>
                    </div>
                `;
            }
        }

        async function testGrammarAnalysis() {
            const resultsDiv = document.getElementById('results');
            const text = getCurrentText();

            if (!text.trim()) {
                resultsDiv.innerHTML = '<div class="result error">Please enter some text first.</div>';
                return;
            }

            resultsDiv.innerHTML = '<div class="result loading">Analyzing grammar...</div>';

            try {
                const response = await fetch('/api/analyze/grammar', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text })
                });

                const data = await response.json();

                if (data.success) {
                    resultsDiv.innerHTML = `
                        <div class="result success">
                            <h3>‚úÖ Grammar Analysis Successful!</h3>
                            <p><strong>Text analyzed:</strong> ${text.length} characters</p>
                            <p><strong>Status:</strong> The grammar analysis API is working correctly.</p>
                            <details>
                                <summary>View full results</summary>
                                <pre>${JSON.stringify(data.analysis, null, 2)}</pre>
                            </details>
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = `
                        <div class="result error">
                            <h3>‚ùå Grammar Analysis Failed</h3>
                            <p><strong>Error:</strong> ${data.error}</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå Connection Error</h3>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p>Make sure the server is running on localhost:3002</p>
                    </div>
                `;
            }
        }

        function clearText() {
            document.getElementById('paste-input').value = '';
            document.getElementById('results').innerHTML = '';
        }
    </script>
</body>
</html>